<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Juan Pablo C. H.</title>
<link>https://juanpacarreon.com/posts.html</link>
<atom:link href="https://juanpacarreon.com/posts.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 20 Dec 2023 06:00:00 GMT</lastBuildDate>
<item>
  <title>Basic Linear Algebra with R</title>
  <link>https://juanpacarreon.com/posts/linear-algebra/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/linear-algebra/images/linear_algebra.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="what-is-linear-algebra" class="level1">
<h1>What is linear algebra?</h1>
<p><a href="https://www.math.ucdavis.edu/~linear/linear-guest.pdf" target="_blank"><em>Linear algebra</em></a> <em>is the study of vectors and linear functions</em>. In this post, I’m going to show you how to perform some basic linear algebra operations with R code.</p>
</section>
<section id="vector-operations" class="level1">
<h1>Vector operations</h1>
<section id="vectors" class="level2">
<h2 class="anchored" data-anchor-id="vectors">Vectors</h2>
<p>A vector is a mathematical object that possesses both magnitude and direction. In other words, a vector is a mathematical entity representing a physical quantity with both a size (or magnitude) and a specific orientation in space. Vectors are used to describe displacements, velocities, forces, and other concepts in mathematics, physics, and other disciplines.</p>
<p>Formally, a vector in three-dimensional space <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D%5E3"> can be represented as an ordered triplet of real numbers <img src="https://latex.codecogs.com/png.latex?(a,%20b,%20c)">, where <img src="https://latex.codecogs.com/png.latex?a">, <img src="https://latex.codecogs.com/png.latex?b">, and <img src="https://latex.codecogs.com/png.latex?c"> are the components of the vector along the x, y, and z axes, respectively. In general, in an <img src="https://latex.codecogs.com/png.latex?n">-dimensional space <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D%5En">, a vector is represented as an <img src="https://latex.codecogs.com/png.latex?n">-tuple <img src="https://latex.codecogs.com/png.latex?(a_1,%20a_2,%20%5Cldots,%20a_n)">.</p>
<p>Vectors can also be geometrically represented as arrows in a coordinate system, where the length of the arrow represents the magnitude of the vector, and the direction of the arrow represents the orientation of the vector in space.</p>
<p>To define vectors, in this case in twodimensions, we can use the function <code>c()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define three vectors in two dimensions</span></span>
<span id="cb1-2">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-4">c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display the vectors</span></span>
<span id="cb1-7">a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3  1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">b</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 -3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">c</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2  2</code></pre>
</div>
</div>
<p>The above vectors can be represented visually as follows (code not shown):</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/linear-algebra/index_files/figure-html/2D vector-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To create vectors in four dimensions, we use the same procedure, but add more elements to each vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define two vectors in fourth dimensions</span></span>
<span id="cb7-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb7-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span></code></pre></div>
</div>
<p>The above procedure can be generalized to any vector in <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D%5En">.</p>
</section>
<section id="sum" class="level2">
<h2 class="anchored" data-anchor-id="sum">Sum</h2>
<p>The sum of two vectors is a mathematical operation that involves adding the corresponding components of the two vectors. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20=%20(a_1,%20a_2,%20%5Cldots,%20a_n)"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BB%7D%20=%20(b_1,%20b_2,%20%5Cldots,%20b_n)"> be two vectors in <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D%5En">. The sum of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BB%7D"> is denoted as <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BB%7D"> and is calculated as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BB%7D%20=%20(a_1%20+%20b_1,%20a_2%20+%20b_2,%20%5Cldots,%20a_n%20+%20b_n)"></p>
<p>In other words, the sum of two vectors produces a new vector whose components are the sum of the corresponding components of the original vectors.</p>
<p>Some important properties of vector addition include commutativity (<img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BB%7D%20=%20%5Cmathbf%7BB%7D%20+%20%5Cmathbf%7BA%7D">), associativity <img src="https://latex.codecogs.com/png.latex?(%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BB%7D)%20+%20%5Cmathbf%7BC%7D%20=%20%5Cmathbf%7BA%7D%20+%20(%5Cmathbf%7BB%7D%20+%20%5Cmathbf%7BC%7D)">, and the existence of a zero vector (<img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B0%7D%20+%20%5Cmathbf%7BA%7D%20=%20%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7B0%7D%20=%20%5Cmathbf%7BA%7D">, where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B0%7D"> is the zero vector).</p>
<p>Vector addition is a fundamental operation in linear algebra and is used in various contexts, such as representing displacements in physics, combining forces, and defining more advanced operations in vector spaces.</p>
<p>With R code you can add vectors with the same length:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50 35 58 50</code></pre>
</div>
</div>
<p>If the vectors don’t have the same length, the elements of the smallest will be recycled:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40 30 50 20</code></pre>
</div>
</div>
</section>
<section id="multiplying-a-vector-by-a-scalar" class="level2">
<h2 class="anchored" data-anchor-id="multiplying-a-vector-by-a-scalar">Multiplying a vector by a scalar</h2>
<p>The multiplication of a vector by a scalar is a mathematical operation that involves multiplying each component of the vector by the scalar. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D"> be a vector and <img src="https://latex.codecogs.com/png.latex?k"> be a scalar; the multiplication of the vector by the scalar is denoted as <img src="https://latex.codecogs.com/png.latex?k%20%5Ccdot%20%5Cmathbf%7BV%7D"> and is calculated as follows:</p>
<p>If <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D%20=%20(v_1,%20v_2,%20%5Cldots,%20v_n)">, then</p>
<p><img src="https://latex.codecogs.com/png.latex?k%20%5Ccdot%20%5Cmathbf%7BV%7D%20=%20(k%20%5Ccdot%20v_1,%20k%20%5Ccdot%20v_2,%20%5Cldots,%20k%20%5Ccdot%20v_n)"></p>
<p>In other words, each component of the original vector is multiplied by the scalar, producing a new vector whose components are the product of each component of the original vector by the scalar.</p>
<p>This operation has various properties, such as associativity <img src="https://latex.codecogs.com/png.latex?(a%20%5Ccdot%20b)%20%5Ccdot%20%5Cmathbf%7BV%7D%20=%20a%20%5Ccdot%20(b%20%5Ccdot%20%5Cmathbf%7BV%7D)">, distributivity with respect to the sum of vectors <img src="https://latex.codecogs.com/png.latex?k%20%5Ccdot%20(%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BB%7D)%20=%20k%20%5Ccdot%20%5Cmathbf%7BA%7D%20+%20k%20%5Ccdot%20%5Cmathbf%7BB%7D">, and distributivity with respect to the sum of scalars <img src="https://latex.codecogs.com/png.latex?(a%20+%20b)%20%5Ccdot%20%5Cmathbf%7BV%7D%20=%20a%20%5Ccdot%20%5Cmathbf%7BV%7D%20+%20b%20%5Ccdot%20%5Cmathbf%7BV%7D">.</p>
<p>To multiply by a scalar, we use the operator <code>*</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300 200 400 100</code></pre>
</div>
</div>
</section>
<section id="dot-or-inner-product" class="level2">
<h2 class="anchored" data-anchor-id="dot-or-inner-product">Dot or inner product</h2>
<p>The dot product, also known as the scalar product or inner product, is a mathematical operation between two vectors that results in a scalar (a single number). The dot product of two vectors <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20=%20(a_1,%20a_2,%20%5Cldots,%20a_n)"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BB%7D%20=%20(b_1,%20b_2,%20%5Cldots,%20b_n)"> is commonly denoted as <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D"> and is calculated as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D%20=%20a_1%20%5Ccdot%20b_1%20+%20a_2%20%5Ccdot%20b_2%20+%20%5Cldots%20+%20a_n%20%5Ccdot%20b_n"></p>
<p>In other words, you multiply the corresponding components of the two vectors and sum these products. The result is a scalar, not a vector.</p>
<p>Some important properties of the dot product include commutativity (<img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D%20=%20%5Cmathbf%7BB%7D%20%5Ccdot%20%5Cmathbf%7BA%7D">), distributivity with respect to the sum of vectors (<img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%20%5Ccdot%20(%5Cmathbf%7BB%7D%20+%20%5Cmathbf%7BC%7D)%20=%20%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D%20+%20%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BC%7D">), and scalar multiplication (<img src="https://latex.codecogs.com/png.latex?k%20%5Ccdot%20(%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D)%20=%20(k%20%5Ccdot%20%5Cmathbf%7BA%7D)%20%5Ccdot%20%5Cmathbf%7BB%7D%20=%20%5Cmathbf%7BA%7D%20%5Ccdot%20(k%20%5Ccdot%20%5Cmathbf%7BB%7D)">), where (<em>k</em>) is a scalar.</p>
<p>The dot product has various applications in geometry, physics, and other mathematical disciplines, and it is fundamental in defining concepts such as vector length, vector projection, and angles between vectors.</p>
<p>In R we use the operator <code>%*%</code> to perform the dot product:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,] 2020</code></pre>
</div>
</div>
<p>Note that this operator returns an object with the classes “matrix” and “array”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
</div>
<p>If you need just the numeric value, use the <code>as.numeric()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2020</code></pre>
</div>
</div>
</section>
<section id="norm" class="level2">
<h2 class="anchored" data-anchor-id="norm">Norm</h2>
<p>The norm of a vector, also known as magnitude or length, is a measure that indicates the absolute size of the vector in Euclidean space. The norm of a vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> in an <img src="https://latex.codecogs.com/png.latex?n">-dimensional space, commonly denoted as <img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bv%7D%5C%7C"> or <img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bv%7D%5C%7C_2">, is calculated using the following formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bv%7D%5C%7C%20=%20%5Csqrt%7Bv_1%5E2%20+%20v_2%5E2%20+%20%5Cldots%20+%20v_n%5E2%7D"></p>
<p>In other words, the norm of a vector is the square root of the sum of the squares of its individual components. This is derived from the Euclidean distance in <img src="https://latex.codecogs.com/png.latex?n">-dimensional space.</p>
<p>Some important properties of the norm include:</p>
<ol type="1">
<li><img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bv%7D%5C%7C%20%5Cgeq%200">: The norm of a vector is always non-negative.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bv%7D%5C%7C%20=%200"> if and only if <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D%20=%20%5Cmathbf%7B0%7D">, where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B0%7D"> is the zero vector.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5C%7C%5Calpha%20%5Ccdot%20%5Cmathbf%7Bv%7D%5C%7C%20=%20%7C%5Calpha%7C%20%5Ccdot%20%5C%7C%5Cmathbf%7Bv%7D%5C%7C"> for any scalar <img src="https://latex.codecogs.com/png.latex?%5Calpha">.</li>
<li>Triangle Inequality: <img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Bu%7D%20+%20%5Cmathbf%7Bv%7D%5C%7C%20%5Cleq%20%5C%7C%5Cmathbf%7Bu%7D%5C%7C%20+%20%5C%7C%5Cmathbf%7Bv%7D%5C%7C">.</li>
</ol>
<p>With R code, the norm or magnitude of a vector can be obtained as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> x)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 54.77226</code></pre>
</div>
</div>
<p>With a vector defined as a matrix object, you can also obtain the magnitude with the function <code>norm</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">norm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 54.77226</code></pre>
</div>
</div>
</section>
<section id="scalar-projections" class="level2">
<h2 class="anchored" data-anchor-id="scalar-projections">Scalar Projections</h2>
<p>The scalar projection of a vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D"> onto another vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Br%7D"> is the length of the projection of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D"> onto the direction of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Br%7D">. It is commonly denoted as <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bproj%7D_%7B%5Cmathbf%7Br%7D%7D(%5Cmathbf%7Bs%7D)"> and is calculated using the following formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bproj%7D_%7B%5Cmathbf%7Br%7D%7D(%5Cmathbf%7Bs%7D)%20=%20%5Cfrac%7B%5Cmathbf%7Bs%7D%20%5Ccdot%20%5Cmathbf%7Br%7D%7D%7B%5C%7C%5Cmathbf%7Br%7D%5C%7C%7D"></p>
<p>Where:</p>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D%20%5Ccdot%20%5Cmathbf%7Br%7D"> denotes the dot product between the two vectors.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?%5C%7C%5Cmathbf%7Br%7D%5C%7C"> is the norm (magnitude) of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Br%7D">.</p></li>
</ul>
<p>The scalar projection of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D"> onto <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Br%7D"> represents the length of the line segment connecting the origin to the point where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D"> projects onto the line following the direction of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Br%7D">.</p>
<p>In R, the scalar projection of a vector <code>s</code> onto a vector <code>r</code> can be obtained with the next code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb24-2">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb24-3"></span>
<span id="cb24-4">r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> s <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> r)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    2</code></pre>
</div>
</div>
<p>In a similar way, you can obtain the vector projection of <code>s</code> onto <code>r</code> using the function <code>norm()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> s <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">norm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(r), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    2</code></pre>
</div>
</div>
</section>
</section>
<section id="matrix-operations" class="level1">
<h1>Matrix operations</h1>
<section id="matrices" class="level2">
<h2 class="anchored" data-anchor-id="matrices">Matrices</h2>
<p>In linear algebra, a matrix is a two-dimensional array of numbers, symbols, or mathematical expressions arranged in rows and columns. A matrix is typically represented by uppercase letters, such as A, B, C, etc., and its elements are denoted by indices indicating the position of a number in the matrix.</p>
<p>For example, a matrix A of size <em>m × n</em> is denoted as:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20=%20%5Cbegin%7Bbmatrix%7D%20a_%7B11%7D%20&amp;%20a_%7B12%7D%20&amp;%20%5Cdots%20&amp;%20a_%7B1n%7D%20%5C%5C%20a_%7B21%7D%20&amp;%20a_%7B22%7D%20&amp;%20%5Cdots%20&amp;%20a_%7B2n%7D%20%5C%5C%20%5Cvdots%20&amp;%20%5Cvdots%20&amp;%20%5Cddots%20&amp;%20%5Cvdots%20%5C%5C%20a_%7Bm1%7D%20&amp;%20a_%7Bm2%7D%20&amp;%20%5Cdots%20&amp;%20a_%7Bmn%7D%20%5Cend%7Bbmatrix%7D"></p>
<p>Here, <img src="https://latex.codecogs.com/png.latex?a_%7Bij%7D"> represents the element in the <em>ith</em> row and <em>jth</em> column of the matrix. In this context, <em>m</em> is the number of rows, and <em>n</em> is the number of columns. When the number of rows is equal to the number of columns (<em>m</em> = <em>n</em>), it is called a square matrix.</p>
<p>Matrices are used in linear algebra to represent and manipulate systems of linear equations, linear transformations, and in various contexts in mathematics, physics, statistics, computer science, and other disciplines. Basic operations with matrices include addition, subtraction, scalar multiplication, and matrix multiplication.</p>
<p>In R, we use the function <code>matrix()</code> to define matrices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define a matrix</span></span>
<span id="cb28-2">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb28-3">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb28-4">m</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    7   -6
[2,]   12    8</code></pre>
</div>
</div>
</section>
<section id="matrix-multiplication-by-a-vector" class="level2">
<h2 class="anchored" data-anchor-id="matrix-multiplication-by-a-vector">Matrix multiplication by a vector</h2>
<p>Matrix-vector multiplication is a fundamental operation in linear algebra. Given a matrix <img src="https://latex.codecogs.com/png.latex?A"> of dimensions <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20n"> and a column vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> of dimension <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%201">, the product of the matrix by the vector, denoted as <img src="https://latex.codecogs.com/png.latex?A%20%5Cmathbf%7Bv%7D">, results in a new column vector of dimension <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%201">.</p>
<p>The operation is performed by multiplying each element in a matrix row by the corresponding element in the vector and summing the resulting products. The element in the <img src="https://latex.codecogs.com/png.latex?i">-th position of the resulting vector is the sum of the products of the elements in the <img src="https://latex.codecogs.com/png.latex?i">-th row of the matrix and the corresponding elements in the vector.</p>
<p>The mathematical expression for the multiplication of a matrix <img src="https://latex.codecogs.com/png.latex?A"> by a column vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> can be written as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Cmathbf%7Bv%7D%20=%20%5Cbegin%7Bbmatrix%7D%20a_%7B11%7D%20&amp;%20a_%7B12%7D%20&amp;%20%5Cdots%20&amp;%20a_%7B1n%7D%20%5C%5C%20a_%7B21%7D%20&amp;%20a_%7B22%7D%20&amp;%20%5Cdots%20&amp;%20a_%7B2n%7D%20%5C%5C%20%5Cvdots%20&amp;%20%5Cvdots%20&amp;%20%5Cddots%20&amp;%20%5Cvdots%20%5C%5C%20a_%7Bm1%7D%20&amp;%20a_%7Bm2%7D%20&amp;%20%5Cdots%20&amp;%20a_%7Bmn%7D%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7D%20v_1%20%5C%5C%20v_2%20%5C%5C%20%5Cvdots%20%5C%5C%20v_n%20%5Cend%7Bbmatrix%7D%20=%20%5Cbegin%7Bbmatrix%7D%20(a_%7B11%7Dv_1%20+%20a_%7B12%7Dv_2%20+%20%5Cdots%20+%20a_%7B1n%7Dv_n)%20%5C%5C%20(a_%7B21%7Dv_1%20+%20a_%7B22%7Dv_2%20+%20%5Cdots%20+%20a_%7B2n%7Dv_n)%20%5C%5C%20%5Cvdots%20%5C%5C%20(a_%7Bm1%7Dv_1%20+%20a_%7Bm2%7Dv_2%20+%20%5Cdots%20+%20a_%7Bmn%7Dv_n)%20%5Cend%7Bbmatrix%7D"></p>
<p>It’s important to note that matrix-vector multiplication is defined when the number of columns in the matrix is equal to the number of rows in the vector. In this case, the result is a new vector with the same number of rows as the matrix and the same number of columns as the original vector.</p>
<p>To perform this operation in R, we use the operator <code>%*%</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix multiplication by a vector</span></span>
<span id="cb30-2">v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb30-3">m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> v</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]   -1
[2,]  108</code></pre>
</div>
</div>
</section>
<section id="matrix-multiplication" class="level2">
<h2 class="anchored" data-anchor-id="matrix-multiplication">Matrix multiplication</h2>
<p>Matrix multiplication is an algebraic operation that combines two matrices to produce a third matrix. Given two matrices <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B">, where matrix <img src="https://latex.codecogs.com/png.latex?A"> has dimensions <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20n"> and matrix <img src="https://latex.codecogs.com/png.latex?B"> has dimensions <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20p">, the product of <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B">, denoted as <img src="https://latex.codecogs.com/png.latex?AB">, results in a new matrix <img src="https://latex.codecogs.com/png.latex?C"> with dimensions <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20p">.</p>
<p>The operation is performed by multiplying each element in a row of the first matrix by the corresponding element in the column of the second matrix and summing the resulting products. The entry in the <img src="https://latex.codecogs.com/png.latex?i">-th row and <img src="https://latex.codecogs.com/png.latex?j">-th column of the resulting matrix <img src="https://latex.codecogs.com/png.latex?C"> is the result of this sum for the intersection of the <img src="https://latex.codecogs.com/png.latex?i">-th row of <img src="https://latex.codecogs.com/png.latex?A"> and the <img src="https://latex.codecogs.com/png.latex?j">-th column of <img src="https://latex.codecogs.com/png.latex?B">.</p>
<p>The mathematical expression for matrix multiplication can be represented as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?C_%7Bij%7D%20=%20%5Csum_%7Bk=1%7D%5E%7Bn%7D%20A_%7Bik%7D%20%5Ccdot%20B_%7Bkj%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?C_%7Bij%7D"> is the element in the <img src="https://latex.codecogs.com/png.latex?i">-th row and <img src="https://latex.codecogs.com/png.latex?j">-th column of matrix <img src="https://latex.codecogs.com/png.latex?C">, <img src="https://latex.codecogs.com/png.latex?A_%7Bik%7D"> is the element in the <img src="https://latex.codecogs.com/png.latex?i">-th row and <img src="https://latex.codecogs.com/png.latex?k">-th column of matrix <img src="https://latex.codecogs.com/png.latex?A">, and <img src="https://latex.codecogs.com/png.latex?B_%7Bkj%7D"> is the element in the <img src="https://latex.codecogs.com/png.latex?k">-th row and <img src="https://latex.codecogs.com/png.latex?j">-th column of matrix <img src="https://latex.codecogs.com/png.latex?B">.</p>
<p>It is important to note that for matrix multiplication to be defined, the number of columns in the first matrix must be equal to the number of rows in the second matrix. The resulting matrix has the number of rows of the first matrix and the number of columns of the second matrix.</p>
<p>To perform multiplications between matrices, we use the operator <code>%*%</code>. Always be sure that the number of columns in the first matrix is the same as the number of rows in the second:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 2 x 3</span></span>
<span id="cb32-2">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb32-3">A</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    0    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 3 x 3</span></span>
<span id="cb34-2">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb34-3">B</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    0
[2,]    0    1    1
[3,]    1    0    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix multiplication</span></span>
<span id="cb36-2">A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> B</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    4    3    5
[2,]    5    4    1</code></pre>
</div>
</div>
</section>
<section id="multiplication-of-a-matrix-by-a-scalar" class="level2">
<h2 class="anchored" data-anchor-id="multiplication-of-a-matrix-by-a-scalar">Multiplication of a matrix by a scalar</h2>
<p>Scalar multiplication by a matrix is an operation in which each element of the matrix is multiplied by the given scalar. Given a scalar <img src="https://latex.codecogs.com/png.latex?c"> and a matrix <img src="https://latex.codecogs.com/png.latex?A"> of dimensions <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20n">, the product of <img src="https://latex.codecogs.com/png.latex?c"> by <img src="https://latex.codecogs.com/png.latex?A">, denoted as <img src="https://latex.codecogs.com/png.latex?cA">, is obtained by multiplying each element of <img src="https://latex.codecogs.com/png.latex?A"> by <img src="https://latex.codecogs.com/png.latex?c">, resulting in a new matrix of the same size <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20n">.</p>
<p>The mathematical expression for scalar multiplication by a matrix can be written as:</p>
<p><img src="https://latex.codecogs.com/png.latex?c%20%5Ccdot%20A%20=%20%5Cbegin%7Bbmatrix%7D%20c%20%5Ccdot%20a_%7B11%7D%20&amp;%20c%20%5Ccdot%20a_%7B12%7D%20&amp;%20%5Cdots%20&amp;%20c%20%5Ccdot%20a_%7B1n%7D%20%5C%5C%20c%20%5Ccdot%20a_%7B21%7D%20&amp;%20c%20%5Ccdot%20a_%7B22%7D%20&amp;%20%5Cdots%20&amp;%20c%20%5Ccdot%20a_%7B2n%7D%20%5C%5C%20%5Cvdots%20&amp;%20%5Cvdots%20&amp;%20%5Cddots%20&amp;%20%5Cvdots%20%5C%5C%20c%20%5Ccdot%20a_%7Bm1%7D%20&amp;%20c%20%5Ccdot%20a_%7Bm2%7D%20&amp;%20%5Cdots%20&amp;%20c%20%5Ccdot%20a_%7Bmn%7D%20%5Cend%7Bbmatrix%7D"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?a_%7Bij%7D"> represents the elements of matrix <img src="https://latex.codecogs.com/png.latex?A">. Each element of the resulting matrix <img src="https://latex.codecogs.com/png.latex?cA"> is simply the product of the scalar <img src="https://latex.codecogs.com/png.latex?c"> with the corresponding element of matrix <img src="https://latex.codecogs.com/png.latex?A">.</p>
<p>As with vectors, we use the operator <code>*</code> to perfrom this operation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix multiplication by a scalar</span></span>
<span id="cb38-2"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> A</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]  100  200  300
[2,]  400    0  100</code></pre>
</div>
</div>
</section>
<section id="range-of-a-matrix" class="level2">
<h2 class="anchored" data-anchor-id="range-of-a-matrix">Range of a matrix</h2>
<p>The rank of a matrix is a measure indicating the maximum number of linearly independent rows or columns in the matrix. We can calculate the rank for both rectangular and square matrices. The specific definition may vary depending on whether you are dealing with the row rank or column rank, but both are related.</p>
<ol type="1">
<li><p><em>Row Rank Definition:</em> The row rank of a matrix is the maximum number of linearly independent rows in the matrix.</p></li>
<li><p><em>Column Rank Definition:</em> The column rank of a matrix is the maximum number of linearly independent columns in the matrix.</p></li>
</ol>
<p>In more general terms, the rank of a matrix can be defined as the dimension of the space spanned by its row or column vectors. An important fact about the rank of a matrix is that the row rank is always equal to the column rank. This is known as the rank theorem and is a crucial property highlighting the relationship between the rows and columns of a matrix.</p>
<p>To calculate the rank of a matrix we use the function <code>qr()</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 3 x 3</span></span>
<span id="cb40-2">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb40-3">C</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    1
[2,]   -2   -3    1
[3,]    3    3    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rank of matrix C</span></span>
<span id="cb42-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qr</span>(C)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rank</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 2 x 4 </span></span>
<span id="cb44-2">D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb44-3">D</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    1    0    2
[2,]   -1   -1    0   -2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rank of matrix D</span></span>
<span id="cb46-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qr</span>(D)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rank</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="inverse-of-a-matrix" class="level2">
<h2 class="anchored" data-anchor-id="inverse-of-a-matrix">Inverse of a matrix</h2>
<p>The inverse of a matrix is a fundamental concept in linear algebra. Given a square matrix <img src="https://latex.codecogs.com/png.latex?A">, <img src="https://latex.codecogs.com/png.latex?A%5E%7B-1%7D"> is said to be the inverse of <img src="https://latex.codecogs.com/png.latex?A"> if the product of <img src="https://latex.codecogs.com/png.latex?A"> by <img src="https://latex.codecogs.com/png.latex?A%5E%7B-1%7D"> (or <img src="https://latex.codecogs.com/png.latex?A%5E%7B-1%7D"> by <img src="https://latex.codecogs.com/png.latex?A">) is equal to the identity matrix <img src="https://latex.codecogs.com/png.latex?I">, of the same size as <img src="https://latex.codecogs.com/png.latex?A">. Mathematically, this is expressed as:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Ccdot%20A%5E%7B-1%7D%20=%20A%5E%7B-1%7D%20%5Ccdot%20A%20=%20I"></p>
<p>Where: * <img src="https://latex.codecogs.com/png.latex?A"> is the original matrix. * <img src="https://latex.codecogs.com/png.latex?A%5E%7B-1%7D"> is the inverse matrix. * <img src="https://latex.codecogs.com/png.latex?I"> is the identity matrix.</p>
<p>It’s important to note that not all matrices have an inverse. For a matrix to have an inverse, it must be a square matrix, and it must be nonsingular, meaning its determinant should not be equal to zero.</p>
<p>If a matrix <img src="https://latex.codecogs.com/png.latex?A"> has an inverse, it is denoted as <img src="https://latex.codecogs.com/png.latex?A%5E%7B-1%7D">, and it satisfies:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Ccdot%20A%5E%7B-1%7D%20=%20A%5E%7B-1%7D%20%5Ccdot%20A%20=%20I"></p>
<p>The inverse matrix has important properties, such as the inverse of the inverse (<img src="https://latex.codecogs.com/png.latex?(A%5E%7B-1%7D)%5E%7B-1%7D%20=%20A">) and the inverse of the product of matrices (<img src="https://latex.codecogs.com/png.latex?(AB)%5E%7B-1%7D%20=%20B%5E%7B-1%7DA%5E%7B-1%7D">), among others.</p>
<p>To calculate the inverse of a matrix we use the <code>solve()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb48-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 4 x 4 </span></span>
<span id="cb48-3">E <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb48-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb48-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb48-6">)</span>
<span id="cb48-7">E</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    7    2    7    7
[2,]   14    5   12   12
[3,]   20   30    4    1
[4,]   27   10   15   16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Inverse of matrix E</span></span>
<span id="cb50-2">E_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(E)</span>
<span id="cb50-3">E_i</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]       [,3]       [,4]
[1,]  -6.597222   4.472222 -0.1527778 -0.4583333
[2,]   7.305556  -5.055556  0.1944444  0.5833333
[3,] -30.625000  21.750000 -0.6250000 -2.8750000
[4,]  35.277778 -24.777778  0.7222222  3.1666667</code></pre>
</div>
</div>
</section>
<section id="solving-systems-of-linear-equations" class="level2">
<h2 class="anchored" data-anchor-id="solving-systems-of-linear-equations">Solving systems of linear equations</h2>
<p>A system of linear equations is a set of two or more linear equations that share a common set of variables. Each linear equation within the system represents a linear relationship between the variables. In general, a system of linear equations can be expressed as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Bcases%7D%20a_%7B11%7Dx_1%20+%20a_%7B12%7Dx_2%20+%20%5Cldots%20+%20a_%7B1n%7Dx_n%20=%20b_1%20%5C%5C%20a_%7B21%7Dx_1%20+%20a_%7B22%7Dx_2%20+%20%5Cldots%20+%20a_%7B2n%7Dx_n%20=%20b_2%20%5C%5C%20%5Cvdots%20%5C%5C%20a_%7Bm1%7Dx_1%20+%20a_%7Bm2%7Dx_2%20+%20%5Cldots%20+%20a_%7Bmn%7Dx_n%20=%20b_m%20%5Cend%7Bcases%7D"></p>
<p>Where:</p>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?x_1,%20x_2,%20%5Cldots,%20x_n"> are the variables of the system.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?a_%7Bij%7D"> are the coefficients accompanying the variables.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?b_i"> are the constant terms in each equation.</p></li>
<li><p>The system has <img src="https://latex.codecogs.com/png.latex?m"> linear equations.</p></li>
</ul>
<p>The typical goal when solving a system of linear equations is to find the values of the variables <img src="https://latex.codecogs.com/png.latex?x_1,%20x_2,%20%5Cldots,%20x_n"> that satisfy all the equations simultaneously. These values represent the solution to the system. Depending on the nature of the system, it may have a unique solution, no solution, or infinitely many solutions. Common methods for solving systems of linear equations include substitution, elimination, and the use of matrices.</p>
<p>Now let us define the following system of linear equations. We want to obtain the values of <img src="https://latex.codecogs.com/png.latex?a">, <img src="https://latex.codecogs.com/png.latex?b">, and <img src="https://latex.codecogs.com/png.latex?c"> that satisfied the system:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?(1):%20a%20+%20b%20+%20c%20=%2015"></li>
<li><img src="https://latex.codecogs.com/png.latex?(2):%203a%20+%202b%20+%20c%20=%2028"></li>
<li><img src="https://latex.codecogs.com/png.latex?(3):%202a%20+%20b%20+%202c%20=%2023"></li>
</ul>
<p>First, define a matrix with the system coefficients and a vector with the results or constants for each equation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Coefficient matrix</span></span>
<span id="cb52-2">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb52-3">C</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    3    2    1
[3,]    2    1    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Constant vector </span></span>
<span id="cb54-2">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>)</span>
<span id="cb54-3">r</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15 28 23</code></pre>
</div>
</div>
<p>Next, obtain the inverse of the coefficient matrix using the <code>solve()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Coefficient matrix inverse</span></span>
<span id="cb56-2">C_inv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(C)</span>
<span id="cb56-3">C_inv</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] -1.5  0.5  0.5
[2,]  2.0  0.0 -1.0
[3,]  0.5 -0.5  0.5</code></pre>
</div>
</div>
<p>To calculate the solution, we multiply the previous inverse matrix by the constant vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Solution</span></span>
<span id="cb58-2">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> C_inv <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> r</span>
<span id="cb58-3">s</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    3
[2,]    7
[3,]    5</code></pre>
</div>
</div>
<p>Thus the solution to our system of equations is as follows:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?a%20=%203"></li>
<li><img src="https://latex.codecogs.com/png.latex?b%20=%207"></li>
<li><img src="https://latex.codecogs.com/png.latex?c%20=%205"></li>
</ul>
</section>
<section id="determinant-of-a-matrix" class="level2">
<h2 class="anchored" data-anchor-id="determinant-of-a-matrix">Determinant of a matrix</h2>
<p>The determinant of a matrix is a scalar associated with that matrix and is commonly denoted as <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdet%7D(A)"> or <img src="https://latex.codecogs.com/png.latex?%7CA%7C">. The process for calculating the determinant varies depending on the size of the matrix.</p>
<ol type="1">
<li><em>First-Order Matrix:</em></li>
</ol>
<p>For a <img src="https://latex.codecogs.com/png.latex?1%20%5Ctimes%201"> matrix, which is simply a number, the determinant is equal to that number.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdet%7D(%5Ba%5D)%20=%20a"></p>
<ol start="2" type="1">
<li><em>Second-Order Matrices:</em></li>
</ol>
<p>For a <img src="https://latex.codecogs.com/png.latex?2%20%5Ctimes%202"> matrix:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdet%7D%5Cbegin%7Bbmatrix%7D%20a%20&amp;%20b%20%5C%5C%20c%20&amp;%20d%20%5Cend%7Bbmatrix%7D%20=%20ad%20-%20bc"></p>
<ol start="3" type="1">
<li><em>Higher-Order Matrices:</em></li>
</ol>
<p>For an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20n"> square matrix <img src="https://latex.codecogs.com/png.latex?A">, the determinant can be calculated using cofactor expansion or more advanced methods such as diagonalization.</p>
<p>The general formula for the determinant of an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20n"> matrix <img src="https://latex.codecogs.com/png.latex?A"> can be expressed recursively in terms of minors and cofactors:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdet%7D(A)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(-1)%5E%7Bi+j%7D%20%5Ccdot%20a_%7Bij%7D%20%5Ccdot%20%5Ctext%7Bdet%7D(M_%7Bij%7D)"></p>
<p>Where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?a_%7Bij%7D"> is the element in row <img src="https://latex.codecogs.com/png.latex?i">, column <img src="https://latex.codecogs.com/png.latex?j"> of matrix <img src="https://latex.codecogs.com/png.latex?A">.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdet%7D(M_%7Bij%7D)"> is the determinant of the minor obtained by removing row <img src="https://latex.codecogs.com/png.latex?i"> and column <img src="https://latex.codecogs.com/png.latex?j"> from matrix <img src="https://latex.codecogs.com/png.latex?A">.</li>
</ul>
<p>To carry out this operation, we use the function <code>det()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">C</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    3    2    1
[3,]    2    1    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">det</span>(C)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2</code></pre>
</div>
</div>
</section>
<section id="transpose-of-a-matrix" class="level2">
<h2 class="anchored" data-anchor-id="transpose-of-a-matrix">Transpose of a Matrix</h2>
<p>The transpose of a matrix is an operation that involves swapping its rows and columns. It is commonly denoted by <img src="https://latex.codecogs.com/png.latex?A%5ET"> or <img src="https://latex.codecogs.com/png.latex?A'">. If <img src="https://latex.codecogs.com/png.latex?A"> is an <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20n"> matrix, then the transpose <img src="https://latex.codecogs.com/png.latex?A%5ET"> is an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20m"> matrix obtained by exchanging the rows and columns of the original matrix.</p>
<p>Mathematically, if <img src="https://latex.codecogs.com/png.latex?A"> has elements <img src="https://latex.codecogs.com/png.latex?a_%7Bij%7D">, then the transpose <img src="https://latex.codecogs.com/png.latex?A%5ET"> has elements <img src="https://latex.codecogs.com/png.latex?b_%7Bij%7D"> where <img src="https://latex.codecogs.com/png.latex?b_%7Bij%7D%20=%20a_%7Bji%7D">. In other words, the element in row <img src="https://latex.codecogs.com/png.latex?i">, column <img src="https://latex.codecogs.com/png.latex?j"> of <img src="https://latex.codecogs.com/png.latex?A%5ET"> is the same as the element in row <img src="https://latex.codecogs.com/png.latex?j">, column <img src="https://latex.codecogs.com/png.latex?i"> of <img src="https://latex.codecogs.com/png.latex?A">.</p>
<p>For example, if <img src="https://latex.codecogs.com/png.latex?A"> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20=%20%5Cbegin%7Bbmatrix%7D%201%20&amp;%202%20&amp;%203%20%5C%5C%204%20&amp;%205%20&amp;%206%20%5Cend%7Bbmatrix%7D"></p>
<p>Then, the transpose <img src="https://latex.codecogs.com/png.latex?A%5ET"> would be:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%5ET%20=%20%5Cbegin%7Bbmatrix%7D%201%20&amp;%204%20%5C%5C%202%20&amp;%205%20%5C%5C%203%20&amp;%206%20%5Cend%7Bbmatrix%7D"></p>
<p>Some important properties of the transpose include:</p>
<ol type="1">
<li><img src="https://latex.codecogs.com/png.latex?(A%5ET)%5ET%20=%20A"></li>
<li><img src="https://latex.codecogs.com/png.latex?(cA)%5ET%20=%20cA%5ET">, where <img src="https://latex.codecogs.com/png.latex?c"> is a constant.</li>
<li><img src="https://latex.codecogs.com/png.latex?(A%20+%20B)%5ET%20=%20A%5ET%20+%20B%5ET">, where <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B"> are matrices compatible for addition.</li>
</ol>
<p>We use the <code>t()</code> function to obtain the transpose of a matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1">C</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    3    2    1
[3,]    2    1    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(C)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    3    2
[2,]    1    2    1
[3,]    1    1    2</code></pre>
</div>
</div>
</section>
<section id="identity-matrix" class="level2">
<h2 class="anchored" data-anchor-id="identity-matrix">Identity matrix</h2>
<p>The identity matrix, commonly denoted by <img src="https://latex.codecogs.com/png.latex?I_n"> or simply <img src="https://latex.codecogs.com/png.latex?I">, is an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20n"> square matrix that has ones on its main diagonal (from the upper-left to the lower-right) and zeros in the rest of its elements. In other words, an identity matrix is a square matrix where all elements outside the main diagonal are zero, and all elements on the main diagonal are one.</p>
<p>The general form of an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20n"> identity matrix is:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_n%20=%20%5Cbegin%7Bbmatrix%7D%201%20&amp;%200%20&amp;%20%5Cldots%20&amp;%200%20%5C%5C%200%20&amp;%201%20&amp;%20%5Cldots%20&amp;%200%20%5C%5C%20%5Cvdots%20&amp;%20%5Cvdots%20&amp;%20%5Cddots%20&amp;%20%5Cvdots%20%5C%5C%200%20&amp;%200%20&amp;%20%5Cldots%20&amp;%201%20%5Cend%7Bbmatrix%7D"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?n"> represents the size of the identity matrix.</p>
<p>It is important to note that the distinctive property of the identity matrix is that when any square matrix <img src="https://latex.codecogs.com/png.latex?A"> is multiplied by the appropriate identity matrix, the result is the same matrix <img src="https://latex.codecogs.com/png.latex?A">. In mathematical terms, if <img src="https://latex.codecogs.com/png.latex?A"> is an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20m"> matrix, then <img src="https://latex.codecogs.com/png.latex?I_n%20%5Ctimes%20A%20=%20A%20%5Ctimes%20I_m%20=%20A">, provided that the dimensions are compatible for multiplication.</p>
<p>To define a identity matrix we use the <code>diag()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Identity matrix of 2 x 2</span></span>
<span id="cb68-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Identity matrix of 4 x 4</span></span>
<span id="cb70-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1</code></pre>
</div>
</div>
</section>
<section id="eigenvalues-and-eingenvectors" class="level2">
<h2 class="anchored" data-anchor-id="eigenvalues-and-eingenvectors">Eigenvalues and eingenvectors</h2>
<p>The concepts of eigenvalues and eigenvectors are fundamental in linear algebra and apply to linear transformations represented by matrices.</p>
<ol type="1">
<li><em>Eigenvalues:</em></li>
</ol>
<p>Given a square matrix <img src="https://latex.codecogs.com/png.latex?A">, an eigenvalue <img src="https://latex.codecogs.com/png.latex?%5Clambda"> is a scalar such that when multiplied by a nonzero vector <img src="https://latex.codecogs.com/png.latex?v">, the result is simply the same vector scaled by <img src="https://latex.codecogs.com/png.latex?%5Clambda">:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Cmathbf%7Bv%7D%20=%20%5Clambda%20%5Cmathbf%7Bv%7D"></p>
<p>Here, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> is the corresponding eigenvector associated with the eigenvalue <img src="https://latex.codecogs.com/png.latex?%5Clambda">. It’s important to note that for an eigenvalue and its corresponding eigenvector, the multiplication of matrix <img src="https://latex.codecogs.com/png.latex?A"> by vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> results in a mere scaling of the vector by the eigenvalue.</p>
<ol start="2" type="1">
<li><em>Eigenvectors:</em></li>
</ol>
<p>Given an eigenvalue <img src="https://latex.codecogs.com/png.latex?%5Clambda">, the corresponding eigenvector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D"> is a nonzero vector that satisfies the equation:</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Cmathbf%7Bv%7D%20=%20%5Clambda%20%5Cmathbf%7Bv%7D"></p>
<p>In other words, when matrix <img src="https://latex.codecogs.com/png.latex?A"> is multiplied by the eigenvector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D">, the result is simply the same vector scaled by the eigenvalue <img src="https://latex.codecogs.com/png.latex?%5Clambda">.</p>
<p>Eigenvectors provide special directions in which the linear transformation represented by matrix <img src="https://latex.codecogs.com/png.latex?A"> has only a scaling effect. The magnitude of this scaling is determined by the corresponding eigenvalue.</p>
<p>We use the function <code>eigen()</code> to obtain the eigenvectors and eigenvalues of a given matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 2 x 2</span></span>
<span id="cb72-2">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb72-3">A</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    3    4
[2,]    0    5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eigen function</span></span>
<span id="cb74-2">A_ei <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eigen</span>(A)</span>
<span id="cb74-3"></span>
<span id="cb74-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eigenvalues</span></span>
<span id="cb74-5">A_lmd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A_ei<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>values</span>
<span id="cb74-6">A_lmd</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eigenvectors</span></span>
<span id="cb76-2">A_ev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A_ei<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vectors</span>
<span id="cb76-3">A_ev</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1] [,2]
[1,] 0.8944272    1
[2,] 0.4472136    0</code></pre>
</div>
</div>
<p>Interestingly, the original matrix can be decomposed as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1">A_ev <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(A_lmd) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(A_ev)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    3    4
[2,]    0    5</code></pre>
</div>
</div>
</section>
<section id="gram-schmidt-process" class="level2">
<h2 class="anchored" data-anchor-id="gram-schmidt-process">Gram-Schmidt process</h2>
<p>The Gram-Schmidt process is a method used in linear algebra to take a set of linearly independent vectors and construct from them an orthogonal or orthonormal set. This process is useful in various contexts, such as matrix diagonalization, solving systems of linear equations, and QR factorization.</p>
<p>Given a set of vectors <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Cmathbf%7Bv%7D_1,%20%5Cmathbf%7Bv%7D_2,%20%5Cldots,%20%5Cmathbf%7Bv%7D_n%5C%7D"> in a Euclidean vector space, the Gram-Schmidt process generates an orthogonal set <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Cmathbf%7Bu%7D_1,%20%5Cmathbf%7Bu%7D_2,%20%5Cldots,%20%5Cmathbf%7Bu%7D_n%5C%7D"> or an orthonormal set <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Cmathbf%7Bq%7D_1,%20%5Cmathbf%7Bq%7D_2,%20%5Cldots,%20%5Cmathbf%7Bq%7D_n%5C%7D"> of vectors.</p>
<p>The Gram-Schmidt process is valuable in situations where we need to work with sets of vectors that are not orthogonal initially but desires to obtain orthogonal sets to simplify calculations and analyses.</p>
<p>To perform this process, you can use the <code>gramSchmidt()</code> function from <code>pracma</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#install.packages("pracma")</span></span>
<span id="cb80-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pracma)</span>
<span id="cb80-3"></span>
<span id="cb80-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A matrix of 3 x 3</span></span>
<span id="cb80-5">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb80-6">A</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    2   -2   18
[2,]    2    1    0
[3,]    1    2    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gramSchmidt function</span></span>
<span id="cb82-2">A_gs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gramSchmidt</span>(A)</span>
<span id="cb82-3"></span>
<span id="cb82-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Orthogonalized matrix</span></span>
<span id="cb82-5">A_gs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Q</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]       [,2]       [,3]
[1,] 0.6666667 -0.6666667  0.3333333
[2,] 0.6666667  0.3333333 -0.6666667
[3,] 0.3333333  0.6666667  0.6666667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Upper triangular matrix </span></span>
<span id="cb84-2">A_gs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    3    0   12
[2,]    0    3  -12
[3,]    0    0    6</code></pre>
</div>
</div>
<p>Note that the above operation allows us to decompose the original matrix such that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1">A_gs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> A_gs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    2   -2   18
[2,]    2    1    0
[3,]    1    2    0</code></pre>
</div>
</div>
</section>
</section>
<section id="calculation-of-mean-and-variance-with-linear-algebra-operations" class="level1">
<h1>Calculation of mean and variance with linear algebra operations</h1>
<p>Statistics like the mean and the variance can be easily done with matrix operations.</p>
<section id="mean" class="level2">
<h2 class="anchored" data-anchor-id="mean">Mean</h2>
<p>Let’s simulate some data and obtain the mean with the <code>mean()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data</span></span>
<span id="cb88-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb88-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>)</span>
<span id="cb88-4"></span>
<span id="cb88-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean function</span></span>
<span id="cb88-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22.96092</code></pre>
</div>
</div>
<p>Using vector multiplication, the mean can be calculated as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample size</span></span>
<span id="cb90-2">yl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(y) </span>
<span id="cb90-3"></span>
<span id="cb90-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector of ones of the same length as y</span></span>
<span id="cb90-5">v1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, yl)</span>
<span id="cb90-6"></span>
<span id="cb90-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculation of the mean</span></span>
<span id="cb90-8">y_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> yl</span>
<span id="cb90-9">y_mean</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 22.96092</code></pre>
</div>
</div>
</section>
<section id="sample-variance" class="level2">
<h2 class="anchored" data-anchor-id="sample-variance">Sample variance</h2>
<p>Something similar can be done with the sample variance. First, let’s calculate the sample variance with the <code>var()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># var function</span></span>
<span id="cb92-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(y)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57.33112</code></pre>
</div>
</div>
<p>Now let’s calculate the sample variance with vector multiplication:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Differences between the data and the sample mean</span></span>
<span id="cb94-2">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_mean)</span>
<span id="cb94-3"></span>
<span id="cb94-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculation of the variance</span></span>
<span id="cb94-5">r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (yl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 57.33112</code></pre>
</div>
</div>
<p>This post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/linear-algebra/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>tutorial</category>
  <category>linear algebra</category>
  <guid>https://juanpacarreon.com/posts/linear-algebra/index.html</guid>
  <pubDate>Wed, 20 Dec 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>What is biotechnology?</title>
  <link>https://juanpacarreon.com/posts/biotechnology/index.html</link>
  <description><![CDATA[ 




<p>In general, biotechnology is defined as the use of living organisms for the production or improvement of goods and/or services. By living organisms, we mean complete organisms (plants, animals, microorganisms such as yeasts, etc.) or parts of them (cells, enzymes, DNA, RNA, etc.). On the other hand, to clarify what we mean by goods or services, let us list some examples. Biotechnology ranges from the production of bread, beer, cheese, and vinegar to the development of vaccines, soil bioremediation, and wastewater purification.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/biotechnology/images/img_1.jpg" class="img-fluid figure-img" width="450"></p>
<figcaption class="figure-caption">Beer in Egypt</figcaption>
</figure>
</div>
<p>As shown in the image above, the Egyptians were already using biotechnology for beer production more than 4,000 years ago. For the production of this beverage, a grain or cereal is needed, commonly barley, which is germinated a little to induce the activity of enzymes and generate sugars in the seed. In later steps, these sugars will be the food for microscopic fungi, known as yeasts, which will produce alcohol as a waste product. Depending on the process and the addition of other ingredients, it is now possible to find a wide variety of beers. Cheers!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/biotechnology/images/img_2.webp" class="img-fluid figure-img" width="450"></p>
<figcaption class="figure-caption">A photograph of yeast obtained by electron microscopy</figcaption>
</figure>
</div>
<p>At present, we essentially use killed pathogens, weakened live pathogens, or parts of even smaller organisms (viruses) to vaccinate us. The application of a vaccine, whether injected or given orally, will stimulate our immune system to be prepared for real infection scenarios. For the production of vaccines against some viruses, genetically modified yeast or mammalian cells are used to produce some component of the virus, which will ultimately be sufficient for our immune system to act against future infections.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.genome.gov/about-genomics/fact-sheets/Understanding-COVID-19-mRNA-Vaccines"><img src="https://juanpacarreon.com/posts/biotechnology/images/img_3.png" class="img-fluid figure-img" width="450"></a></p>
<figcaption class="figure-caption">How the RNA vaccines work</figcaption>
</figure>
</div>
<p>In wastewater treatment, large tanks are used where bacteria, yeasts, cyanobacteria (blue algae), algae, protozoa, rotifers, mites, and nematodes (cylindrical worms) act together to degrade harmful substances in the water. It is also possible to use tank towers without air contact, where specialized bacteria (archaeobacteria) will degrade substances in the wastewater and produce methane gas, which can then be used as an energy source (biogas).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/biotechnology/images/img_4.jpg" class="img-fluid figure-img" width="450"></p>
<figcaption class="figure-caption">Wastewater treatment tanks</figcaption>
</figure>
</div>
<p>It goes without saying that biotechnology needs a lot of scientific disciplines: mathematics, chemistry, organic chemistry, biochemistry, molecular and cell biology, microbiology, and many others come together to support and shape it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.britannica.com/technology/biotechnology"><img src="https://juanpacarreon.com/posts/biotechnology/images/img_5.webp" class="img-fluid figure-img" width="450"></a></p>
<figcaption class="figure-caption">Genetically modified organisms</figcaption>
</figure>
</div>
<p>The above are just a few examples of how biotechnology is applied in various fields. Keep in mind that it is currently a very active field of research where knowledge is constantly being generated. Biotechnology is everywhere and is important in our daily lives!</p>
<section id="to-learn-more-about-biotechnology" class="level3">
<h3 class="anchored" data-anchor-id="to-learn-more-about-biotechnology">To learn more about biotechnology</h3>
<p>Abdelfattah, A., Ali, S. S., Ramadan, H., El-Aswar, E. I., Eltawab, R., Ho, S.-H., Elsamahy, T., Li, S., El-Sheekh, M. M., Schagerl, M., Kornaros, M., &amp; Sun, J. (2023). Microalgae-based wastewater treatment: Mechanisms, challenges, recent advances, and future prospects. <em>Environmental Science and Ecotechnology</em>, <em>13</em>, 100205. <a href="https://doi.org/10.1016/j.ese.2022.100205" class="uri">https://doi.org/10.1016/j.ese.2022.100205</a></p>
<p>Capece, A., Romaniello, R., Siesto, G., &amp; Romano, P. (2018). Conventional and non-conventional yeasts in beer production. <em>Fermentation</em>, <em>4</em>(2), 38. <a href="https://doi.org/10.3390/fermentation4020038" class="uri">https://doi.org/10.3390/fermentation4020038</a></p>
<p>Gupta, V., Sengupta, M., Prakash, J., &amp; Tripathy, B. C. (2017). An introduction to biotechnology. En <em>Basic and Applied Aspects of Biotechnology</em> (pp.&nbsp;1-21). Springer Singapore. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7119977/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7119977/</a></p>
<p>Renneberg, R., Berkling, V., &amp; Loroch, V. (2017). Viruses, antibodies, and vaccines. En <em>Biotechnology for Beginners</em> (pp.&nbsp;165-200). Elsevier. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7149558/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7149558/</a></p>
<p>The Editors of Encyclopædia Britannica. (2023). <em>Biotechnology</em>. Britannica. <a href="https://www.britannica.com/technology/biotechnology" class="uri">https://www.britannica.com/technology/biotechnology</a></p>
<p><em>The text in this publication is free to use under license <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/biotechnology/https:/i.creativecommons.org/l/by/4.0/88x31.png" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>science communication</category>
  <category>biotechnology</category>
  <guid>https://juanpacarreon.com/posts/biotechnology/index.html</guid>
  <pubDate>Tue, 19 Dec 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>R tutorial: Principal Component Analysis with Metabolomics Data</title>
  <link>https://juanpacarreon.com/posts/pca-matabolomics/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/images/cover.jpg" class="img-fluid figure-img" width="800"></p>
</figure>
</div>
<p>In this tutorial we will cover the steps necessary to perform a principal component analysis (<em>PCA</em>) on metebolomic data from cell cultures of a specific plant. This will help us to visualize groupings and determine possible correlations.</p>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>For this tutorial we will use a few functions inside <code>tidyverse</code>.</p>
<p>To install all packages in tidyverse you can run the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span></code></pre></div>
</div>
<p>And then load them into your R session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>Let’s imagine that we are interested in the effect that salt stress (due to high concentrations of NaCl) could have on plant metabolism. For this purpose, we designed an experiment with cell cultures of <a href="https://academic.oup.com/jxb/article/58/3/415/556150" target="_blank"><em>Arabidopsis thaliana</em></a> species and applied different concentrations of salt in the culture medium for different times. At the end of the treatment time, we recorded the relative amount of various metabolites of interest. See the figure below for clarity:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/images/experiment.jpg" class="img-fluid figure-img" width="800"></p>
</figure>
</div>
<p>It should be noted that salt stress is an important factor limiting plant growth and the experiment just described falls within the field of study of <a href="https://pubmed.ncbi.nlm.nih.gov/28196646/" target="_blank">metabolomics</a>, the study of the totality of compounds produced by the metabolism of living organisms.</p>
<p>For this tutorial I took as a basis the paper: <a href="https://pubmed.ncbi.nlm.nih.gov/17118972/" target="_blank">Time-course metabolic profiling in Arabidopsis thaliana cell cultures after salt stress treatment</a>. I simulated the relative quantity data from the means and standard deviations reported in this article. If you are interested in how I performed such a simulation, take a look at the <code>data_simulation.R</code> and <code>paper_data_processing.R</code> files in the repository of this tutorial: <a href="https://github.com/juanpa-biotech/pca-metabolomics/tree/master" target="_blank">Principal Component Analysis with Metabolomics Data</a>.</p>
</section>
<section id="import-data" class="level1">
<h1>Import data</h1>
<p>Data can be imported directly from the repository of this post with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">main_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/pca-metabolomics/master/data/main_data.csv"</span>)</span></code></pre></div>
</div>
<p>We can display the first six rows of our data frame with the <code>head()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(main_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  MET            TIME SAMPLE    QT
  &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 aspartic acid   0.5      1 0.728
2 aspartic acid   0.5      2 0.839
3 aspartic acid   0.5      3 0.707
4 aspartic acid   1        1 0.746
5 aspartic acid   1        2 0.894
6 aspartic acid   1        3 0.686</code></pre>
</div>
</div>
<p>The <code>SAMPLE</code> column refers to the replicates of each treatment (salt concentration per given time), in this case three.</p>
<p>The names of the metabolites are as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">met_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>(main_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MET)</span>
<span id="cb6-2">met_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(met_names)</span>
<span id="cb6-3">met_names</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "aspartic acid"   "asparagine"      "serine"          "glycine"        
 [5] "alanine"         "glutamic acid"   "glutamine"       "threonine"      
 [9] "proline"         "valine"          "tryptophan"      "isoleucine"     
[13] "leucine"         "phenylalanine"   "pyruvate"        "lactate"        
[17] "phosphorate"     "n-butylamine"    "ethanolamine"    "glycerol"       
[21] "succinate"       "glycerate"       "fumarate"        "cadaverine"     
[25] "malate"          "4-aminobutyrate" "cysteine"        "a-ketoglutarate"
[29] "aconitate"       "putrescine"      "ribonate"        "shikimate"      
[33] "citrate"         "D-fructose"      "glucose"         "lysine"         
[37] "tyrosine"        "gluconate"       "galactonate"     "inositol"       
[41] "uric acid"       "sucrose"         "trehalose"      </code></pre>
</div>
</div>
<p>Let us first restructure the data in a suitable form for later use in the function in charge of performing the PCA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Obtain wide data </span></span>
<span id="cb8-2">main_data_wd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> main_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SAMPLE_TIME =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(SAMPLE, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, TIME)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> SAMPLE_TIME, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> QT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>TIME<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:-</span>SAMPLE)</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transposing just quantity values</span></span>
<span id="cb8-7">qt_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(main_data_wd[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>
<p>Our new data matrix has the following structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">qt_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10]
1-0.5 0.728 1.100 0.776 0.907 0.956 0.433 0.469 0.906 0.954 0.822
2-0.5 0.839 0.978 0.789 0.908 0.960 0.476 0.459 0.998 0.948 0.816
3-0.5 0.707 1.170 0.819 0.908 0.935 0.429 0.426 0.869 0.982 0.815
1-1   0.746 1.000 0.828 0.857 0.829 0.559 0.628 1.010 1.020 0.982
2-1   0.894 0.957 0.861 0.851 0.811 0.551 0.804 1.040 1.050 1.060
3-1   0.686 0.953 0.796 0.858 0.844 0.546 0.707 1.040 1.050 0.984
1-2   0.772 1.200 0.927 0.958 0.848 0.503 0.598 1.080 0.920 0.994
2-2   0.762 1.290 0.829 0.970 0.790 0.498 0.593 1.050 0.939 1.170
3-2   0.783 1.410 1.030 0.961 0.884 0.454 0.614 0.994 0.926 1.060
1-4   1.160 1.020 0.899 0.826 0.937 0.661 0.723 0.981 0.813 1.030</code></pre>
</div>
</div>
<p>Each row indicates an experimental unit corresponding to a given salt concentration and time, while the columns indicate the relative amounts of each metabolite.</p>
<p>Now let’s carry out the PCA directly with the <code>prcomp()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">qt_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(qt_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>When using this function, always remember to check the form of your data and be clear where the response variables and experimental units or replicates are marked. Usually we will be interested in reducing the number of dimensions with respect to the responses and trying to detect if there are similarities or differences between the experimental units of each treatment. With this in mind, when using <code>prcomp()</code> always make sure that the experimental units are positioned in the rows and the response variables in the columns.</p>
<p>On the other hand, the <code>scale.</code> argument refers to dividing each data (centered with respect to the average) by the standard deviation of the corresponding response or variable. It is recommended that this argument be set to <code>scale. = TRUE</code> when the data are not on the same measurement scale or you want to give equal importance to each variable regardless of its range or magnitude. Following what is reported in the article mentioned above, we use <code>scale. = FALSE</code>, which may be reasonable since the data are on the same relative scale.</p>
<p>Subsequently, let’s generate a summary of the analysis with the <code>summary()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(qt_pca)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2     PC3     PC4     PC5     PC6     PC7
Standard deviation     5.3118 2.0027 0.94721 0.85199 0.54284 0.47582 0.41538
Proportion of Variance 0.8068 0.1147 0.02565 0.02076 0.00843 0.00647 0.00493
Cumulative Proportion  0.8068 0.9215 0.94712 0.96787 0.97630 0.98277 0.98771
                           PC8     PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     0.35457 0.24837 0.23917 0.21549 0.19492 0.19206 0.13877
Proportion of Variance 0.00359 0.00176 0.00164 0.00133 0.00109 0.00105 0.00055
Cumulative Proportion  0.99130 0.99306 0.99470 0.99603 0.99711 0.99817 0.99872
                          PC15    PC16    PC17    PC18    PC19    PC20    PC21
Standard deviation     0.10145 0.09904 0.08583 0.06810 0.06295 0.05556 0.05293
Proportion of Variance 0.00029 0.00028 0.00021 0.00013 0.00011 0.00009 0.00008
Cumulative Proportion  0.99901 0.99929 0.99951 0.99964 0.99975 0.99984 0.99992
                          PC22    PC23      PC24
Standard deviation     0.03973 0.03507 2.305e-16
Proportion of Variance 0.00005 0.00004 0.000e+00
Cumulative Proportion  0.99996 1.00000 1.000e+00</code></pre>
</div>
</div>
<p>In the summary above check the <code>Proportion of Variation</code> row. It can be seen that <code>PC1</code> and <code>PC2</code> explain most of the variability in the data.</p>
</section>
<section id="display-of-results" class="level1">
<h1>Display of results</h1>
<p>Before making some graphs to help us visualize the results of the PCA, it may be useful to establish a single theme that applies to each graph:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(</span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb14-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>),</span>
<span id="cb14-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>),</span>
<span id="cb14-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb14-7">    ) </span>
<span id="cb14-8">)</span></code></pre></div>
</div>
<section id="bar-chart-with-the-percentages-of-variation-of-each-main-component" class="level2">
<h2 class="anchored" data-anchor-id="bar-chart-with-the-percentages-of-variation-of-each-main-component">Bar chart with the percentages of variation of each main component</h2>
<p>To visualize the results of our analysis we need to extract some values from the <code>qt_pca</code> object. First let’s extract the data in <code>qt_pca$sdev</code> and do some operations to represent the percentages of variation of each component:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the variance of each principal component in PCA and store it in var_pca</span></span>
<span id="cb15-2">var_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> qt_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sdev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the percentage of total variance explained by each principal component</span></span>
<span id="cb15-5">per_var_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>((var_pca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(var_pca)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a tibble (data frame) to store the results, with columns PC and PER_VAR</span></span>
<span id="cb15-8">per_var_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb15-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(per_var_pca),</span>
<span id="cb15-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PER_VAR =</span> per_var_pca</span>
<span id="cb15-11">)</span>
<span id="cb15-12"></span>
<span id="cb15-13">per_var_pca</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 2
      PC PER_VAR
   &lt;int&gt;   &lt;dbl&gt;
 1     1   80.7 
 2     2   11.5 
 3     3    2.57
 4     4    2.08
 5     5    0.84
 6     6    0.65
 7     7    0.49
 8     8    0.36
 9     9    0.18
10    10    0.16
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>Let’s represent the data in per_var_pca with a bar chart:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">bar_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> per_var_pca[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PER_VAR)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% of total variance"</span>)</span>
<span id="cb17-6"></span>
<span id="cb17-7">bar_pca</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/variation bar chart-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As can be seen, and as we also saw in the summary of the previous section, the first two components account for most of the variation observed in the data.</p>
</section>
<section id="scatterplot-with-the-first-two-principal-components" class="level2">
<h2 class="anchored" data-anchor-id="scatterplot-with-the-first-two-principal-components">Scatterplot with the first two principal components</h2>
<p>Since the first two components account for most of the variation, it is possible to make a two-dimensional plot that adequately represents all the data. We first extract the <code>qt_pca</code> scores and give an appropriate shape to the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">pca_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(qt_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">TIME =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(qt_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stop =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(TIME)</span></code></pre></div>
</div>
<p>Subsequently, let’s make a scatter plot with the scores of the first two components:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">pca_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">TIME =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>(TIME)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> TIME)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 ("</span>, per_var_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PER_VAR[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 ("</span>, per_var_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PER_VAR[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dark2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (h)"</span>)</span>
<span id="cb19-8"></span>
<span id="cb19-9">pca_plot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/scatter plot for pc1 and pc2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is interesting to note that there are several well-defined groupings and differences. In particular, the samples at time 72 h are separated from the rest with respect to PC1, while the 24 h samples are separated with respect to PC2.</p>
</section>
<section id="line-graph-with-metabolite-loadings" class="level2">
<h2 class="anchored" data-anchor-id="line-graph-with-metabolite-loadings">Line graph with metabolite loadings</h2>
<p>Which metabolites contribute to the differences observed in the scatter plot above? Let us answer this question with the help of the weights or loadings.</p>
<p>Let us first extract the loads from <code>qt_pca</code> and also give a suitable shape to the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compound names</span></span>
<span id="cb20-2">compound_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(main_data, SAMPLE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, TIME <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(MET) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>()          </span>
<span id="cb20-5"></span>
<span id="cb20-6">loadigns_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(qt_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">signif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MET =</span> compound_names, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">INDEX =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(MET)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(MET, INDEX) </span></code></pre></div>
</div>
<p>Let us define a small function that replaces with a blank space the name of the metabolite if the absolute value of its charge is less than a selected threshold:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to assign compound name if absolute value of loading is bigger than set threshold</span></span>
<span id="cb21-2">load_tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(loadings, threshold, compound_name) {</span>
<span id="cb21-3">  compound_name[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(loadings) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> threshold] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(compound_name)</span>
<span id="cb21-5">}</span></code></pre></div>
</div>
<p>In the following graph (PC1 loadings), using our function together with <code>geom_text()</code> shows the names of the metabolites whose load is greater than the selected threshold:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">load_line_pc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadigns_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(MET, INDEX, PC1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb22-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MET =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_tr</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loading =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">compound_name =</span> MET)</span>
<span id="cb22-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> INDEX, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> MET)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_nudge</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Compound Index"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loadings"</span>)</span>
<span id="cb22-11"></span>
<span id="cb22-12">load_line_pc1</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/pc1 loadings-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For PC2 the loadings are displayed in the same way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">load_line_pc2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadigns_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(MET, INDEX, PC2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MET =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_tr</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loading =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.19</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">compound_name =</span> MET)</span>
<span id="cb23-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> INDEX, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> MET)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb23-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_nudge</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb23-10">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Compound Index"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loadings"</span>)</span>
<span id="cb23-13"></span>
<span id="cb23-14">load_line_pc2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/pc2 loadings-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From both graphs we can tentatively define the metabolites that contributed most to the similarities or differences observed in the scatter plot of PC1 and PC2: lactate, sucrose, tryptophan, phenylalanine, glycerol, inositol, lysine, uric acid, tyrosine and sucrose.</p>
<p>It is important to note that the thresholds selected are similar to those of the aforementioned article. However, I believe it is important to be careful with the criteria for determining whether the loads can be considered “large” or “small”. An alternative approach could be to simply take the tables with the loadings values and order them with respect to their absolute value, which would also allow us to determine the metabolites with the largest loadings.</p>
</section>
<section id="patterns-of-metabolite-variation" class="level2">
<h2 class="anchored" data-anchor-id="patterns-of-metabolite-variation">Patterns of metabolite variation</h2>
<p>Now that we know which compounds could be considered the most important, we can focus our attention on these metabolites and make a graph to see their pattern of behavior over time of stress treatment.</p>
<p>Let us first consider the most important metabolites with respect to PC1. From the original data, let us take only the lactate and sucrose data and obtain the average of the relative amounts at each treatment time. We can visualize the averages obtained with a line graph:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">met_plot_pc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> main_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lactate"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sucrose"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(MET, TIME) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MEAN_QT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(QT)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> TIME, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MEAN_QT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> MET)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (h)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Relative quantity"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">met_plot_pc1</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/pc1 metabolites-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is noticeable that at 72 h the levels of these compounds increased greatly. This is probably the reason for the differences observed in the scatter plot of PC1 and PC2.</p>
<p>Let us repeat the same procedure for the most important metabolites with respect to PC2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">met_plot_pc2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> main_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tryptophan"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phenylalanine"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glycerol"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb27-3">         MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tyrosine"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inositol"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lysine"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb27-4">         MET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uric acid"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(MET, TIME) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MEAN_QT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(QT)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> TIME, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MEAN_QT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> MET)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (h)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Relative quantity"</span>)</span>
<span id="cb27-12"></span>
<span id="cb27-13">met_plot_pc2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-matabolomics/index_files/figure-html/pc2 metabolites-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this visualization we omit sucrose because we have already seen its behavior pattern. Although this graph is a little less clear, we can see that at 24 hours, the levels of metabolites such as glycerol and inositol increased, while the levels of aromatic amino acids decreased.</p>
</section>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li><p>In this tutorial on principal component analysis (PCA) applied to plant metabolomics data, simulated data from Arabidopsis thaliana cell cultures under salt stress were used.</p></li>
<li><p>Through the implementation of the PCA with <code>prcomp()</code> and other functions included in <code>tidyverse</code> packages, clustering and correlations in the data could be observed.</p></li>
</ul>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/pca-matabolomics/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>tutorial</category>
  <category>pca</category>
  <category>principal component analysis</category>
  <category>metabolomics</category>
  <guid>https://juanpacarreon.com/posts/pca-matabolomics/index.html</guid>
  <pubDate>Fri, 01 Dec 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>R tutorial: Principal Component Analysis from scratch</title>
  <link>https://juanpacarreon.com/posts/pca-from-scratch/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/img/cover.jpeg" class="img-fluid figure-img" width="450"></p>
</figure>
</div>
<p>All the data and code of this post can be download on the next repository : <a href="https://github.com/juanpa-biotech/pca-from-scratch">pca-from-scratch</a></p>
<section id="what-is-principal-component-analysis" class="level1">
<h1>What is principal component analysis?</h1>
<p><a href="https://en.wikipedia.org/wiki/Principal_component_analysis" target="_blank">Principal component analysis (PCA)</a> is an exploratory data analysis based on the reduction of dimensions of a given data set. The general idea is to reduce the data set so that it has fewer dimensions while retaining as much information as possible.</p>
<p>PCA allows us to make visual representations in two dimensions and to check for groupings or differences in the data related to different states, treatments, etc. In addition, we can get some clue as to which variables in the data are responsible for the visual differences.</p>
<p>It is important to emphasize that the PCA is not used exclusively for the above, and given that it is an exploratory analysis, the similarities or differences observed in the data should be considered with caution and in the context from which they originate.</p>
</section>
<section id="a-simple-case-with-two-dimensional-data" class="level1">
<h1>A simple case with two-dimensional data</h1>
<p>Let’s start with a simple example with two-dimensional data, which will allow us to visualize some of the basic concepts behind PCA and then generalize what we have learned to data with more than two dimensions.</p>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>For this post we will use some functions included in <code>ggplot2</code>, <code>ggpubr</code>, <code>readr</code>, <code>purrr</code> and <code>dplyr</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the next line if you have not installed the packages:</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages(c("ggplot2", "ggpubr", "readr", "purrr", "dplyr"))</span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggpubr)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
</div>
</section>
<section id="data-simulation" class="level2">
<h2 class="anchored" data-anchor-id="data-simulation">Data simulation</h2>
<p>First let’s simulate data with two dimensions. To do this let’s make the second variable directly dependent on the first one and store everything in a data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For data reproducibility</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variable 1</span></span>
<span id="cb2-4">var_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variable 2</span></span>
<span id="cb2-7">var_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both variables in a data frame</span></span>
<span id="cb2-10">data_set_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(var_1, var_2)</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_set_1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  var_1 var_2
  &lt;dbl&gt; &lt;dbl&gt;
1  48.1  24.7
2  50.6  24.2
3  47.5  24.3
4  54.8  25.4
5  51.0  28.0
6  47.5  27.2</code></pre>
</div>
</div>
<p>If we make a scatter plot we can observe the clear dependence between both variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A scatter plot with the two simulated variables</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_set_1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> var_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> var_2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variable 1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variable 2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scatter plot for 2d data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="first-step-center-each-variable" class="level2">
<h2 class="anchored" data-anchor-id="first-step-center-each-variable">First step: Center each variable</h2>
<p>The first step in the PCA is to center each variable with respect to its average value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">data_set_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_set_1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">varc_1 =</span> var_1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(var_1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">varc_2 =</span> var_2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(var_2))</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_set_1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  var_1 var_2 varc_1  varc_2
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1  48.1  24.7 -2.18  -0.604 
2  50.6  24.2  0.250 -1.14  
3  47.5  24.3 -2.81  -1.02  
4  54.8  25.4  4.48   0.0829
5  51.0  28.0  0.687  2.62  
6  47.5  27.2 -2.76   1.85  </code></pre>
</div>
</div>
<p>This did not change the relative position between each point, so the data look the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_set_1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> varc_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> varc_2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scatter plot for centered data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="second-step-obtaining-the-covariance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="second-step-obtaining-the-covariance-matrix">Second step: Obtaining the covariance matrix</h2>
<p>The next step is to obtain the covariance matrix for the previous data set. For this we perform a matrix multiplication with the data as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select only the centered variables</span></span>
<span id="cb8-2">data_set_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_set_1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(varc_1, varc_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>()</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the covariance matrix</span></span>
<span id="cb8-7">cov_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb8-8"></span>
<span id="cb8-9">cov_m</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         varc_1   varc_2
varc_1 6.220943 2.946877
varc_2 2.946877 4.207523</code></pre>
</div>
</div>
<p>In the resulting matrix the diagonal contains the variance of each variable while the values outside the diagonal are the covariances between the variables (see figure below):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/img/image_1.jpg" class="img-fluid figure-img" width="450"></p>
</figure>
</div>
<p>We can obtain the covariance matrix directly with the <code>cov()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cov</span>(data_set_2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         varc_1   varc_2
varc_1 6.220943 2.946877
varc_2 2.946877 4.207523</code></pre>
</div>
</div>
<p>Or with the crossprod() function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossprod</span>(data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         varc_1   varc_2
varc_1 6.220943 2.946877
varc_2 2.946877 4.207523</code></pre>
</div>
</div>
</section>
<section id="third-step-obtain-the-eigenvalues-and-eigenvectors-of-the-covariance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="third-step-obtain-the-eigenvalues-and-eigenvectors-of-the-covariance-matrix">Third step: Obtain the eigenvalues and eigenvectors of the covariance matrix</h2>
<p>Principal components represent the directions in the data that explain the maximum amount of variance. They are “lines” that collect most of the information in the data. These directions can be obtained by calculating the eigenvalues and eigenvectors of the covariance matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use eigen() to obtain eigenvectors and eigenvalues</span></span>
<span id="cb14-2">cov_e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eigen</span>(cov_m)</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Eigenvectors</span></span>
<span id="cb14-5">e_vec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cov_e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vectors</span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Eigenvalues</span></span>
<span id="cb14-8">e_val <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cov_e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>values</span></code></pre></div>
</div>
<p>The span of each eigenvector can be considered the “line” that captures most of the variation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First eigenvector </span></span>
<span id="cb15-2">ev_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> e_vec[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Slope of the first eigenvector</span></span>
<span id="cb15-5">ev1_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ev_1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ev_1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Second eigenvector </span></span>
<span id="cb15-8">ev_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> e_vec[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb15-9"></span>
<span id="cb15-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Slope of the second eigenvector</span></span>
<span id="cb15-11">ev2_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ev_2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ev_2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb15-12"></span>
<span id="cb15-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot showing the span of both eigenvectors </span></span>
<span id="cb15-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_2), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> varc_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> varc_2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> ev1_m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> ev2_m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scatter plot with each principal component for 2d data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As can be seen, there is one eigenvector for each variable in the data set, in this case two. Also note that the eigenvectors are perpendicular:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply both eigenvectors </span></span>
<span id="cb16-2">ev_1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> ev_2</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    0</code></pre>
</div>
</div>
<p>As for the eigenvalues, their numerical values are equal to the sum of squares of the distances of each projected data point in the corresponding principal component. This sum of squares is maximized in the first principal component.</p>
</section>
<section id="fourth-step-make-a-scree-plot" class="level2">
<h2 class="anchored" data-anchor-id="fourth-step-make-a-scree-plot">Fourth step: Make a Scree Plot</h2>
<p>Dividing each eigenvalue by <em>n - 1</em> (<em>n</em> is the number of rows in the original data) will give an estimate of the variance represented by each principal component. The sum of all variances (the total variance) can be used to calculate the percentage of variation and visualized with a Scree Plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the estimated variance for each eigenvalue</span></span>
<span id="cb18-2">e_var <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> e_val <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data frame with variance percentages</span></span>
<span id="cb18-5">var_per <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb18-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2"</span>),</span>
<span id="cb18-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(e_var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(e_var) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the percentage</span></span>
<span id="cb18-8">    )</span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scree plot </span></span>
<span id="cb18-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(var_per, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PER)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Principal component"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percentage of variation (%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scree plot 2d data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fifth-step-obtain-the-loadings-of-each-variable." class="level2">
<h2 class="anchored" data-anchor-id="fifth-step-obtain-the-loadings-of-each-variable.">Fifth step: Obtain the loadings of each variable.</h2>
<p>The eigenvectors obtained using the <code>eigen()</code> function are normalized. This means that their length is equal to 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Norm of the first eigenvector</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">norm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(ev_1), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Norm of the second eigenvector</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">norm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(ev_2), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>The elements of each eigenvector are also called loadings and can be interpreted as the contribution of each variable in the data set to the corresponding principal component or, more strictly, as the coefficients of the linear combination of the original variables from which the principal components are constructed.</p>
<p>We can make a table with these values and see the contributions of each variable to each principal component:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data frame with both eigenvectors</span></span>
<span id="cb23-2">loads <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">VAR   =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"var_1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"var_2"</span>),</span>
<span id="cb23-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC1 =</span> ev_1, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First eigenvecor</span></span>
<span id="cb23-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC2 =</span> ev_2  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Second eigenvectors</span></span>
<span id="cb23-6">)</span>
<span id="cb23-7"></span>
<span id="cb23-8">loads</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  VAR      PC1    PC2
  &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 var_1 -0.813  0.582
2 var_2 -0.582 -0.813</code></pre>
</div>
</div>
<p>The above can be useful in data with many dimensions to get an idea of which variables cause the groupings or differences in the PCA plot.</p>
</section>
<section id="sixth-step-representing-data-in-fewer-dimensions" class="level2">
<h2 class="anchored" data-anchor-id="sixth-step-representing-data-in-fewer-dimensions">Sixth step: Representing data in fewer dimensions</h2>
<p>If we change the base of the original data to that indicated by the eigenvectors, we are basically rotating the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change the basis of the original data </span></span>
<span id="cb25-2">data_set_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_set_2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(e_vec) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Inverse of eigenvectors matrix</span></span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter showing the rotation </span></span>
<span id="cb25-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_3), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X1, X2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 (78.8%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 (21.2%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/change of basis-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comparing the two graphs gives us an idea of how the data have been rotated once we change the base:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with the centered data </span></span>
<span id="cb26-2">plot_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_2), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> varc_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> varc_2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Original Data"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb26-9"></span>
<span id="cb26-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with the rotated data</span></span>
<span id="cb26-11">plot_rotation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_3), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X1, X2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 (78.8%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 (21.2%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Change of Basis to Eigenvectors"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb26-20"></span>
<span id="cb26-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both graphs side by side</span></span>
<span id="cb26-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(plot_data, plot_rotation)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/compare rotation and original 2d data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Since principal component 1 (PC1) explains most of the variance in the data, we can omit principal component 2 (PC2) and represent each point in a single dimension, here as red dots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data points just from PC 1</span></span>
<span id="cb27-2">data_pc1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v1 =</span> data_set_3[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_3)))</span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot showing the projected points from PC1 (red points)</span></span>
<span id="cb27-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_3), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X1, X2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_pc1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(v1, v2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 (78.8%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 (21.2%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/projections on PC1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above ideas can be used in data with many variables to reduce the dimensions and make two-dimensional representations of the data.</p>
</section>
</section>
<section id="generalization-to-data-with-more-than-two-dimensions" class="level1">
<h1>Generalization to data with more than two dimensions</h1>
<p>Let us now apply the same procedure to a data set with more variables, namely <a href="https://ucphchemometrics.com/2023/06/01/wine-samples-analyzed-by-gc-ms-and-ft-ir-instruments/" target="_blank">wine samples analyzed by GC-MS and FT-IR instruments</a>, where the following responses were measured:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/img/image_2.jpg" class="img-fluid figure-img" width="350"></p>
</figure>
</div>
<p>The wine samples come from Argentina, Chile, Australia and South Africa:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/img/image_3.jpg" class="img-fluid figure-img" width="230"></p>
</figure>
</div>
<p>The first six rows of the data set look as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variable names</span></span>
<span id="cb28-2">var_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/pca-from-scratch/master/data/Label_Pred_values_IR.csv"</span>)</span>
<span id="cb28-3">var_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(var_names)</span>
<span id="cb28-4"></span>
<span id="cb28-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wine labels</span></span>
<span id="cb28-6">wine_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/pca-from-scratch/master/data/Label_Wine_samples.csv"</span>)</span>
<span id="cb28-7">wine_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(wine_label))</span>
<span id="cb28-8"></span>
<span id="cb28-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wine data set</span></span>
<span id="cb28-10">data_set_wine <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(</span>
<span id="cb28-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/pca-from-scratch/master/data/Pred_values.csv"</span>, </span>
<span id="cb28-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> var_names</span>
<span id="cb28-13">)</span>
<span id="cb28-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row.names</span>(data_set_wine) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wine_label</span>
<span id="cb28-15"></span>
<span id="cb28-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(data_set_wine))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Ethanol TotalAcid VolatileA MalicAcid   pH LacticAc ReSugar CitricAcid
ARG-BNS1   13.62      3.54      0.29      0.89 3.71     0.78    1.46       0.31
ARG-DDA1   14.06      3.74      0.59      0.24 3.73     1.25    2.42       0.18
ARG-FFL1   13.74      3.27      0.47     -0.07 3.87     1.13    1.52       0.39
ARG-FLM1   13.95      3.66      0.47      0.09 3.79     1.00    4.17       0.41
ARG-ICR1   14.47      3.66      0.38      0.61 3.70     0.81    1.25       0.14
ARG-SAL1   14.61      3.45      0.52      0.16 3.92     1.76    1.40       0.10
            CO2 Density FolinC Glycerol Methanol TartaricA
ARG-BNS1  85.61    0.99  60.92     9.72     0.16      1.74
ARG-DDA1 175.20    1.00  70.64    10.05     0.20      1.58
ARG-FFL1 513.74    0.99  63.59    10.92     0.18      1.24
ARG-FLM1 379.40    1.00  73.30     9.69     0.23      2.26
ARG-ICR1 154.88    0.99  71.69    10.81     0.20      1.22
ARG-SAL1 156.30    0.99  71.79    10.19     0.19      0.90</code></pre>
</div>
</div>
<p>Note that the wine samples are marked as the names of the rows in the data frame and in turn wine samples have associated values for each response (in the columns). Pay attention to this when calculating covariance matrices or using functions to perform PCA, do you want to reduce the dimensions with respect to rows or with respect to columns? Here we are interested in reducing the number of dimensions with respect to the responses (columns) and try to detect if there are any similarities or differences between the wine samples.</p>
<section id="first-step-center-the-data" class="level2">
<h2 class="anchored" data-anchor-id="first-step-center-the-data">First step: Center the data</h2>
<p>Subtract the average of each variable (columns) and divide by its standard deviation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Means for each variable</span></span>
<span id="cb30-2">var_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(data_set_wine, mean))</span>
<span id="cb30-3"></span>
<span id="cb30-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation for each variable</span></span>
<span id="cb30-5">var_sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(data_set_wine, sd))</span>
<span id="cb30-6"></span>
<span id="cb30-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center each variable</span></span>
<span id="cb30-8">data_set_wine_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(</span>
<span id="cb30-9">  data_set_wine, var_means, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, mean) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean</span>
<span id="cb30-10">  )</span>
<span id="cb30-11"></span>
<span id="cb30-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Devide by the standard deviation of each variable</span></span>
<span id="cb30-13">data_set_wine_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(</span>
<span id="cb30-14">  data_set_wine_2, var_sd, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, sd) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sd</span>
<span id="cb30-15">)</span>
<span id="cb30-16"></span>
<span id="cb30-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a matrix from the previous list</span></span>
<span id="cb30-18">data_set_wine_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_wine_2))</span></code></pre></div>
</div>
<p>Each row of the transformed data corresponds to the same wine sample as the original data.</p>
<p>The first six rows of the transformed data look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_set_wine_2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Ethanol   TotalAcid  VolatileA  MalicAcid         pH    LacticAc
[1,] -0.63678489 -0.40870999 -0.7811641  2.2627949 0.18823560 -0.88226788
[2,]  0.29224039  0.01096889  1.3231961 -0.5694123 0.40060357  0.38388752
[3,] -0.38341492 -0.97527630  0.4814521 -1.9201573 1.88717938  0.06061381
[4,]  0.05998306 -0.15690246  0.4814521 -1.2229986 1.03770749 -0.28959935
[5,]  1.15792167 -0.15690246 -0.1498560  1.0427673 0.08205162 -0.80144937
[6,]  1.45351898 -0.59756526  0.8321787 -0.9179917 2.41810183  1.75780072
        ReSugar CitricAcid        CO2    Density     FolinC     Glycerol
[1,] -0.5311188  1.1594919 -1.6049333 -0.7844233 -0.1371321 -0.525885112
[2,]  0.1996454  0.1084153 -0.9482843  1.2458487  1.2376582 -0.160707985
[3,] -0.4854461  1.8063082  1.5330409 -0.7844233  0.2405111  0.802031815
[4,]  1.5317676  1.9680124  0.5483973  1.2458487  1.6138874 -0.559083800
[5,] -0.6909735 -0.2149929 -1.0972195 -0.7844233  1.3861700  0.680306454
[6,] -0.5767916 -0.5384012 -1.0868116 -0.7844233  1.4003137 -0.005784995
       Methanol   TartaricA
[1,] -1.1081037  0.43877622
[2,] -0.0870238 -0.03865555
[3,] -0.5975636 -1.05319836
[4,]  0.6787860  1.99042973
[5,] -0.0870238 -1.11287729
[6,] -0.3422939 -2.06774119</code></pre>
</div>
</div>
<p>Dividing by standard deviations is a way of giving each variable equal importance despite its range, magnitude and/or scale of measurement. In addition to dividing by the standard deviation, it is possible to apply other transformations depending on the data. See the resources at the end of this post if you are interested.</p>
</section>
<section id="second-step-calculating-the-covariance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="second-step-calculating-the-covariance-matrix">Second step: Calculating the covariance matrix</h2>
<p>We multiply the data (in matrix form) by its transpose:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the covariance matrix</span></span>
<span id="cb33-2">cov_wine <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(data_set_wine_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> data_set_wine_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb33-3">  (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_wine_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb33-4"></span>
<span id="cb33-5">cov_wine[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Ethanol  TotalAcid  VolatileA   MalicAcid         pH
Ethanol   1.00000000  0.3262321  0.2028382  0.04166778  0.1697347
TotalAcid 0.32623209  1.0000000  0.4660575 -0.26067574 -0.3518303
VolatileA 0.20283816  0.4660575  1.0000000 -0.74628880  0.3011611
MalicAcid 0.04166778 -0.2606757 -0.7462888  1.00000000 -0.2929542
pH        0.16973470 -0.3518303  0.3011611 -0.29295421  1.0000000</code></pre>
</div>
</div>
<p>Here we only show the first five rows and columns of the covariance matrix. If you want to display the whole matrix a good way is to use the <code>View()</code> function.</p>
<p>Each value of the cov_wine matrix has the same interpretation as in the example with two variables, the values on the diagonal are the variances of each variable, and the values outside the diagonal are the covariances between variables. As can be seen, all variances are equal to 1. This is precisely the effect of centering and dividing by the standard deviation.</p>
</section>
<section id="third-step-obtain-the-eigenvalues-and-eigenvectors-of-the-covariance-matrix." class="level2">
<h2 class="anchored" data-anchor-id="third-step-obtain-the-eigenvalues-and-eigenvectors-of-the-covariance-matrix.">Third step: Obtain the eigenvalues and eigenvectors of the covariance matrix.</h2>
<p>Let’s use the <code>eigen()</code> function to obtain the eigenvectors and their eigenvalues:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eigen() to obtain eigenvalues and eigenvectors</span></span>
<span id="cb35-2">eg_wine <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eigen</span>(cov_wine)</span>
<span id="cb35-3"></span>
<span id="cb35-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Eigenvalues</span></span>
<span id="cb35-5">eg_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> eg_wine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>values</span>
<span id="cb35-6"></span>
<span id="cb35-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Eigenvectors</span></span>
<span id="cb35-8">eg_vecs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> eg_wine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vectors</span></code></pre></div>
</div>
<p>The number of vectors and eigenvalues is the same as the number of variables in the original data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of eigenvalues</span></span>
<span id="cb36-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eg_vals)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of eigenvectors</span></span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(eg_vecs)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
</section>
<section id="fourth-step-make-a-scree-plot-1" class="level2">
<h2 class="anchored" data-anchor-id="fourth-step-make-a-scree-plot-1">Fourth step: Make a Scree Plot</h2>
<p>We calculated the percentage of variation of each component and made a Scree plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate variances from each eigenvalue</span></span>
<span id="cb40-2">eg_vars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> eg_vals <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data_set_wine_2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb40-3"></span>
<span id="cb40-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data frame with variance percenatges</span></span>
<span id="cb40-5">vars_perc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb40-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC"</span>, x))),</span>
<span id="cb40-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>((eg_vars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(eg_vars), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb40-8">    )</span>
<span id="cb40-9"></span>
<span id="cb40-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scree plot</span></span>
<span id="cb40-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb40-12">  vars_perc, </span>
<span id="cb40-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(PC, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(PER, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PER)</span>
<span id="cb40-14">       ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Principal component"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percentage of variation (%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb40-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scree plor for wine data-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fifth-step-obtain-the-loadings-of-each-variable" class="level2">
<h2 class="anchored" data-anchor-id="fifth-step-obtain-the-loadings-of-each-variable">Fifth step: Obtain the loadings of each variable</h2>
<p>The elements of each eigenvector represent the weight of each variable in the corresponding principal component:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data frame with loading scores</span></span>
<span id="cb41-2">loads_wine <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(eg_vecs)</span>
<span id="cb41-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(loads_wine) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vars_perc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC</span>
<span id="cb41-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(loads_wine) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> var_names</span>
<span id="cb41-5"></span>
<span id="cb41-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(loads_wine)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 PC1        PC2         PC3         PC4          PC5
Ethanol   -0.2050720 -0.3452884  0.28833198 -0.33833697  0.001102612
TotalAcid -0.1457210 -0.4545803 -0.06374908  0.42139270  0.041508881
VolatileA  0.2959952 -0.4418538  0.03338975  0.08430388 -0.010891943
MalicAcid -0.3401714  0.3173079  0.17907611 -0.04002812 -0.252870227
pH         0.2413635 -0.1030772 -0.04459655 -0.66472873 -0.170592677
LacticAc   0.3462627 -0.3745378 -0.16738658  0.11850141 -0.108643313
                  PC6          PC7         PC8        PC9        PC10
Ethanol   -0.02992588  0.106645514  0.40565762  0.2220668 -0.07364281
TotalAcid -0.10721872  0.109080109 -0.15801515  0.1647662 -0.12640759
VolatileA  0.12676353 -0.117134957 -0.01066998 -0.2323371  0.19698524
MalicAcid  0.09495473  0.247290148 -0.35870967  0.1792700 -0.27203174
pH         0.01717167 -0.191605073 -0.30040129  0.3352703  0.28827462
LacticAc   0.05496474  0.008009813 -0.10169448  0.1377493 -0.28605639
                 PC11        PC12        PC13        PC14
Ethanol    0.52247393 -0.22486081  0.29025392 -0.04195694
TotalAcid -0.09209975 -0.25488777 -0.01537897  0.65083548
VolatileA  0.19114512 -0.33800898 -0.59864002 -0.27743084
MalicAcid -0.07338526 -0.53559762 -0.18854505 -0.23066288
pH        -0.21200577 -0.09998927 -0.02838824  0.28223548
LacticAc  -0.32247769 -0.11583440  0.49548494 -0.45696212</code></pre>
</div>
</div>
<p>Making a scatter plot with these values can help determine correlations between variables and/or explain why a particular clustering is observed in principal component scatter plots (next section):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with loadings of PC1 and PC2</span></span>
<span id="cb43-2">ld_pc12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(loads_wine, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(PC1, PC2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(loads_wine)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loadings for PC1 and PC2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 (24.4%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 (21.3%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb43-13"></span>
<span id="cb43-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with loadings of PC3 and PC4</span></span>
<span id="cb43-15">ld_pc34 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(loads_wine, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(PC3, PC4)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(loads_wine)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loadings for PC3 and PC4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC3 (17.5%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC4 (10.0%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb43-26"></span>
<span id="cb43-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both graphs side by side</span></span>
<span id="cb43-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(ld_pc12, ld_pc34)  </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/plot loading scores-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="sixth-step-representing-data-in-fewer-dimensions-1" class="level2">
<h2 class="anchored" data-anchor-id="sixth-step-representing-data-in-fewer-dimensions-1">Sixth step: Representing data in fewer dimensions</h2>
<p>Ideally, if PC1 and PC2 picked up most of the variation, say more than 90%, it would be possible to make a good representation of the data in a two-dimensional scatter plot. But since real data are almost never ideal, in this case PC1, PC2, PC3 and PC4 account for 73% of the variation. Let us try to observe clustering using two scatter plots, the first with PC1 and PC2, and the second with PC3 and PC4.</p>
<p>First, we change the basis of the transformed data to that indicated by the eigenvectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change the basis of the data</span></span>
<span id="cb44-2">data_set_wine_eb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_set_wine_2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(eg_vecs)</span>
<span id="cb44-3"></span>
<span id="cb44-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transfrom to a data frame</span></span>
<span id="cb44-5">data_set_wine_eb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(data_set_wine_eb)</span>
<span id="cb44-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(data_set_wine_eb) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vars_perc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC</span>
<span id="cb44-7"></span>
<span id="cb44-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a column with the origin of each wine sample</span></span>
<span id="cb44-9">data_set_wine_eb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_set_wine_eb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb44-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">WineSample =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(wine_label, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">substr</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span>
<span id="cb44-12">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(WineSample)</span>
<span id="cb44-14"></span>
<span id="cb44-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_set_wine_eb)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  WineSample        PC1        PC2        PC3        PC4         PC5
1        ARG -0.8708602  1.4271679  1.0042682 -0.4970542 -2.40194963
2        ARG  0.9214933 -0.8023313  0.9170387 -0.3788901  0.04278493
3        ARG  2.0993602 -1.1582579  0.1104490 -0.8588001  0.36878072
4        ARG  2.6784566  0.6585042 -0.5914731 -1.1987690  0.55471303
5        ARG -0.3093155 -0.7061611  0.9719731 -0.8791527 -1.48911945
6        ARG  0.6656888 -1.9938918  2.0606329 -0.4319683 -0.58522246
          PC6        PC7        PC8         PC9         PC10        PC11
1 -0.50073335  0.7380182 -0.7113971  1.28454429  0.141197785  0.91258285
2 -1.11669152 -0.6204253  0.1024002 -0.66345802  0.217715309 -0.44779807
3 -0.01460188  0.6155704  1.2988198 -0.31647718 -1.945505546  1.56333545
4 -1.77225038  1.1845744  0.7517347 -0.01741376 -0.458803511 -1.38374975
5  0.58458758 -1.3525017  0.3597807  1.06873458  0.656603378 -0.04068736
6  0.76213010 -0.9997045  2.4380628 -1.36498248 -0.004949351  1.27477965
        PC12        PC13        PC14
1 -0.0961029 -0.01151848  0.12807023
2  0.6191680 -1.13863351 -0.22032005
3 -0.2843139  1.44732864  0.08942808
4  0.1136096 -1.16558478 -0.14095094
5 -0.4097057  0.16732603 -0.70481769
6 -0.5940964 -0.93709414 -0.52629641</code></pre>
</div>
</div>
<p>Now, let’s make both scatter plots taking only the values of PC1, PC2, PC3 and PC4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot for PC1 and PC2</span></span>
<span id="cb46-2">pc12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb46-3">  data_set_wine_eb, </span>
<span id="cb46-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(PC1, PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> WineSample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> WineSample)</span>
<span id="cb46-5">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 and PC2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC1 (24.4%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC2 (21.3%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) </span>
<span id="cb46-12"></span>
<span id="cb46-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot for PC3 and PC4</span></span>
<span id="cb46-14">pc34 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb46-15">  data_set_wine_eb, </span>
<span id="cb46-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(PC3, PC4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> WineSample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> WineSample)</span>
<span id="cb46-17">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(</span>
<span id="cb46-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wine origin"</span>, </span>
<span id="cb46-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Argentina"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Africa"</span>)</span>
<span id="cb46-22">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_discrete</span>(</span>
<span id="cb46-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wine origin"</span>, </span>
<span id="cb46-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Argentina"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Africa"</span>)</span>
<span id="cb46-26">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC3 and PC4"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC3 (17.5%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC4 (10.0%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb46-31"></span>
<span id="cb46-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Both graphs side by side</span></span>
<span id="cb46-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(pc12, pc34)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/pca-from-scratch/index_files/figure-html/scatters plot for PC 1 2 3 4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li><p>Principal component analysis (PCA) is a methodology that allows us to reduce the dimensionality of data while preserving important information.</p></li>
<li><p>PCA is used to visualize data with many dimensions in two-dimensional plots, identify groupings and differences, and determine which variables are most relevant. However, its interpretation should be done with caution due to its exploratory nature.</p></li>
<li><p>PCA can be performed in several steps with basic functions and linear algebra operations using the following steps:</p>
<ol type="1">
<li>Center each variable.</li>
<li>Calculate the covariance matrix.</li>
<li>Obtain eigenvalues and eigenvectors representing directions of maximum variation.</li>
<li>Make a Scree Plot to visualize the variance explained by each component.</li>
<li>Obtain the loadigns of the variables in the principal components.</li>
<li>Represent the data in reduced dimensions, generally in two dimensions.</li>
</ol></li>
</ul>
</section>
<section id="additional-resources" class="level1">
<h1>Additional Resources</h1>
<p>It is important to know linear algebra to understand and visualize the core of PCA. The 3Blue1Brown video series is an excellent starting point for learning linear algebra:</p>
<p><a href="https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab" target="_blank">Essence of linear algebra</a>.</p>
<p>Intuitive explanations of the PCA can be found in other channels:</p>
<p><a href="https://www.youtube.com/watch?v=g-Hb26agBFg" target="_blank">Principal Component Analysis (PCA)</a>.</p>
<p><a href="https://www.youtube.com/watch?v=FgakZw6K1QQ&amp;t=914s" target="_blank">StatQuest: Principal Component Analysis (PCA), Step-by-Step</a>.</p>
<p>If you would like to see some examples of the application of this analysis to experimental data here are two articles oriented to chemometrics and metabolomics:</p>
<p><a href="https://pubs.rsc.org/en/content/articlelanding/2014/ay/c3ay41907j" target="_blank">Principal component analysis</a>.</p>
<p><a href="https://bmcgenomics.biomedcentral.com/articles/10.1186/1471-2164-7-142" target="_blank">Centering, scaling, and transformations: improving the biological information content of metabolomics data</a>.</p>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/pca-from-scratch/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>tutorial</category>
  <category>pca</category>
  <category>principal component analysis</category>
  <category>linear algebra</category>
  <guid>https://juanpacarreon.com/posts/pca-from-scratch/index.html</guid>
  <pubDate>Mon, 30 Oct 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>R tutorial: Simultaneus Optimization of Several Response Variables</title>
  <link>https://juanpacarreon.com/posts/simultaneus_optimization/index.html</link>
  <description><![CDATA[ 




<p>The data and code for this publication can be found in the following repository: <a href="https://github.com/juanpa-biotech/simultaneous-optimization" target="_blank">simultaneous-optimization</a>.</p>
<section id="the-problem-of-optimizing-several-response-variables" class="level1">
<h1>The problem of optimizing several response variables</h1>
<p>When we perform an experiment it is common to quantify more than one response variable in each of our experimental units. Depending on our objectives or needs, we might be interested in maximizing and/or minimizing some responses, while some others would only be measured to characterize the process, but we want them to stay within defined limits. How do we approach optimization taking into account each response variable? In other words, we want to find an optimal solution that allows us to find the best, or desirable, values for each response.</p>
<p>One way to solve the above problem is by means of the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6217265/" target="_blank">desirability function method</a>, which allows us to obtain a global optimum taking into account all the response variables.</p>
<p>In general, the desirability function method consists of defining a function that covers the entire experimental region and estimates the global desirability (<img src="https://latex.codecogs.com/png.latex?GD">). The <img src="https://latex.codecogs.com/png.latex?GD"> in turn is defined taking into account all the responses, which allows to reduce a multivariate optimization problem to a single variable one. The objective becomes maximizing <img src="https://latex.codecogs.com/png.latex?GD">.</p>
<p>To define GD we first transform each predicted response <img src="https://latex.codecogs.com/png.latex?yp_i(x)"> into an individual desirability value <img src="https://latex.codecogs.com/png.latex?d_i(x)"> that falls in the interval <img src="https://latex.codecogs.com/png.latex?%5B0,%201%5D">. The transformation <img src="https://latex.codecogs.com/png.latex?d_i(x)"> of each response is performed according to the target values set by the investigator and measures the desirability at the experimental point or treatment <img src="https://latex.codecogs.com/png.latex?X%20=%20(x_1,%20x_2,%20x_3,%20...,%20x_k)">, where each <img src="https://latex.codecogs.com/png.latex?x_i"> corresponds to each of the experimental factors considered in the design.</p>
<p>If the variable <img src="https://latex.codecogs.com/png.latex?yp_i(x)"> has an upper specification (<img src="https://latex.codecogs.com/png.latex?US_i">), a lower specification (<img src="https://latex.codecogs.com/png.latex?LS_i">) and its target value is <img src="https://latex.codecogs.com/png.latex?T_i">, the transformation <img src="https://latex.codecogs.com/png.latex?d_i(x)"> is defined as:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/img/eq_1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The exponents <img src="https://latex.codecogs.com/png.latex?s"> and <img src="https://latex.codecogs.com/png.latex?t"> are used to choose the form of the transformation. Assigning large values to these exponents, greater than or equal to 5, for example, will only yield desirability values close to 1 when <img src="https://latex.codecogs.com/png.latex?yp_i(x)"> is sufficiently close to the target value. On the other hand, selecting small values of <img src="https://latex.codecogs.com/png.latex?s"> and <img src="https://latex.codecogs.com/png.latex?t"> <img src="https://latex.codecogs.com/png.latex?(%E2%89%A4%200.10)"> will yield desirability values close to 1 for a wide range of values within the interval <img src="https://latex.codecogs.com/png.latex?%5BLS_i,%20US_i%5D">. If both exponents are selected equal to 1, a linear increase in desirability will be obtained as the values of <img src="https://latex.codecogs.com/png.latex?yp_i(x)"> approach the target value.</p>
<p>Once the <img src="https://latex.codecogs.com/png.latex?m"> desirabilities have been calculated for the <img src="https://latex.codecogs.com/png.latex?m"> responses at the point within the experimental region <img src="https://latex.codecogs.com/png.latex?X_i">, the <img src="https://latex.codecogs.com/png.latex?GD"> at <img src="https://latex.codecogs.com/png.latex?X_i"> is defined by a weighted geometric mean:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/img/eq_2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In this case, the weights <img src="https://latex.codecogs.com/png.latex?w_i"> are constants that are assigned to balance the relative importance of each response variable compared to the others. The larger the value of <img src="https://latex.codecogs.com/png.latex?w">, the greater the requirement that the <img src="https://latex.codecogs.com/png.latex?GD"> result benefits that response. If we select a value of 1 for each <img src="https://latex.codecogs.com/png.latex?w">, the above equation reduces to:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/img/eq_3.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The global optimum experimental point <img src="https://latex.codecogs.com/png.latex?X_0"> is the point at which the value of <img src="https://latex.codecogs.com/png.latex?GD(X_0)"> is maximum. To find this maximum value we apply a numerical method.</p>
<p>With this brief explanation of the method, it is now time to perform a practical example with R code. For this I will use the data published in <a href="https://www.tandfonline.com/doi/abs/10.1080/00224065.1980.11980968" target="_balnk">George Derringer &amp; Ronald Suich (1980)</a>.</p>
</section>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>For this post I used the <code>readr</code>, <code>rsm</code>, <code>desirability</code> and <code>colorRamps</code> packages. If you haven’t installed them you can run the following code to do so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rsm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desirability"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"colorRamps"</span>))</span></code></pre></div>
</div>
</section>
<section id="import-data" class="level1">
<h1>Import data</h1>
<p>The experimental data are in a CSV file and have the usual structure of a design matrix. To import the data from the repository of this post we can use the <code>read_csv()</code> function of the <code>readr</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb2-2"></span>
<span id="cb2-3">data_tires <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/simultaneous-optimization/master/data_tires.csv"</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data_tires)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
     x1    x2    x3    Y1    Y2    Y3    Y4
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    -1    -1     1   102   900   470  67.5
2     1    -1    -1   120   860   410  65  
3    -1     1    -1   117   800   570  77.5
4     1     1     1   198  2294   240  74.5
5    -1    -1    -1   103   490   640  62.5
6     1    -1     1   132  1289   270  67  </code></pre>
</div>
</div>
<p>The data correspond to an experiment whose objective is to improve the formulation of belts for the manufacture of tires, so that certain quality parameters are met. The <img src="https://latex.codecogs.com/png.latex?x_i"> correspond to the factors and the <img src="https://latex.codecogs.com/png.latex?Y_i"> to the responses.</p>
<p>The information in the columns is as follows:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?x1">: level of hydrated silica.</li>
<li><img src="https://latex.codecogs.com/png.latex?x2">: level of silane coupling agent</li>
<li><img src="https://latex.codecogs.com/png.latex?x3">: sulfur level</li>
<li><img src="https://latex.codecogs.com/png.latex?Y1">: PICO abrasion index</li>
<li><img src="https://latex.codecogs.com/png.latex?Y2">: modulus 200</li>
<li><img src="https://latex.codecogs.com/png.latex?Y3">: elongation at break</li>
<li><img src="https://latex.codecogs.com/png.latex?Y4">: hardness</li>
</ul>
<p>We look for the values of each response variable to meet the following requirements:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?Y1%20%3E%20120"></li>
<li><img src="https://latex.codecogs.com/png.latex?Y2%20%3E%201000"></li>
<li><img src="https://latex.codecogs.com/png.latex?400%20%3C%20Y3%20%3C%20600"></li>
<li><img src="https://latex.codecogs.com/png.latex?60%20%3C%20Y4%20%3C%2075"></li>
</ul>
<p>Thus we could ask the question: Which treatment (combination of the <img src="https://latex.codecogs.com/png.latex?x_i">) within our experimental region would allow us to achieve the above specifications?</p>
</section>
<section id="second-order-model-fitting" class="level1">
<h1>Second-order model fitting</h1>
<p>It is important to note that the experimental design that corresponds to our data is a response surface design, so we fit second-order models for each response using the <code>rsm</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rsm)</span>
<span id="cb4-2"></span>
<span id="cb4-3">y1_m  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsm</span>(Y1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SO</span>(x1, x2, x3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_tires)</span>
<span id="cb4-4">y2_m  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsm</span>(Y2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SO</span>(x1, x2, x3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_tires)</span>
<span id="cb4-5">y3_m  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsm</span>(Y3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SO</span>(x1, x2, x3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_tires)</span>
<span id="cb4-6">y4_m  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsm</span>(Y4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SO</span>(x1, x2, x3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_tires)</span></code></pre></div>
</div>
<p>The models for each response follow the general equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/img/eq_4.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>To get an idea of the variability explained by each model I defined a small function that returns the coefficient of determination and the fitted coefficient of determination for a given model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get a R^2 and adjusted R^2 from a linear model</span></span>
<span id="cb5-2">get_r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model){</span>
<span id="cb5-3">  sum_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> sum_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r.squared, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adj.R2 =</span> sum_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>adj.r.squared), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb5-5">}</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Table with R-squared for each model</span></span>
<span id="cb5-8">y1_r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_r2</span>(y1_m)</span>
<span id="cb5-9">y2_r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_r2</span>(y2_m)</span>
<span id="cb5-10">y3_r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_r2</span>(y3_m) </span>
<span id="cb5-11">y4_r2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_r2</span>(y4_m)</span>
<span id="cb5-12"></span>
<span id="cb5-13">r2t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1_m =</span> y1_r2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2_m =</span> y2_r2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y3_m =</span> y3_r2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y4_m =</span> y4_r2))</span>
<span id="cb5-14">r2t</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        R2 adj.R2
y1_m 0.972  0.947
y2_m 0.742  0.510
y3_m 0.981  0.965
y4_m 0.958  0.921</code></pre>
</div>
</div>
<p>As can be seen in the table, the coefficients of determination of the <img src="https://latex.codecogs.com/png.latex?Y2"> model are lower than the rest. This should be taken into account, as there could be another model that fits the <img src="https://latex.codecogs.com/png.latex?Y2"> data better. However, for learning purposes I used all quadratic models as was done in the Derringer &amp; Suich (1980) paper.</p>
</section>
<section id="simultaneous-optimization" class="level1">
<h1>Simultaneous optimization</h1>
<section id="definition-of-functions-for-simultaneous-optimization" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-functions-for-simultaneous-optimization">Definition of functions for simultaneous optimization</h2>
<p>For simultaneous optimization I defined a couple of functions. First a prediction function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prediction function</span></span>
<span id="cb7-2">rsm_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, dObject, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"square"</span>){</span>
<span id="cb7-3">  </span>
<span id="cb7-4">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2 =</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x3 =</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb7-5">  </span>
<span id="cb7-6">  y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y1_m, df)</span>
<span id="cb7-7">  y2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y2_m, df)</span>
<span id="cb7-8">  y3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y3_m, df)</span>
<span id="cb7-9">  y4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y4_m, df)</span>
<span id="cb7-10">  </span>
<span id="cb7-11">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(dObject, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> y1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y2 =</span> y2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y3 =</span> y3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y4 =</span> y4))</span>
<span id="cb7-12">  </span>
<span id="cb7-13">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(space <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"circular"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>) out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(space <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"square"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>)) out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> </span>
<span id="cb7-15">  </span>
<span id="cb7-16">  out</span>
<span id="cb7-17">}</span></code></pre></div>
</div>
<p>This function specifies two possible shapes for the experimental region: <em>square</em> and <em>circular</em>. This must be taken into account and may vary according to our experimental design.</p>
<p>Subsequently, I defined a function that will be in charge of finding the best global desirability value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimization function</span></span>
<span id="cb8-2">maximize_overall <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">int_1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>),</span>
<span id="cb8-3">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">int_2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>),</span>
<span id="cb8-4">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">int_3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.63</span>),</span>
<span id="cb8-5">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dObject =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb8-6">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"square"</span>){</span>
<span id="cb8-7">  </span>
<span id="cb8-8">  searchGrid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(</span>
<span id="cb8-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(int_1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], int_1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb8-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(int_2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], int_2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb8-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(int_3[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], int_3[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb8-12">  )</span>
<span id="cb8-13">  </span>
<span id="cb8-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(searchGrid)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb8-15">    </span>
<span id="cb8-16">    tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(searchGrid[i,]),</span>
<span id="cb8-17">                 rsm_opt,</span>
<span id="cb8-18">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dObject =</span> dObject,</span>
<span id="cb8-19">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> space, </span>
<span id="cb8-20">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fnscale =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb8-21">    </span>
<span id="cb8-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) best <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp</span>
<span id="cb8-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> best<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value) best <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp</span>
<span id="cb8-24">  }</span>
<span id="cb8-25">  </span>
<span id="cb8-26">  best</span>
<span id="cb8-27">}</span></code></pre></div>
</div>
<p>Note that in the previous functions I took into account the maximum and minimum coded values of each factor, in this case 1.63 and -1.63, respectively. If you wish to use this code with your own data do not forget to modify these values according to your experimental design.</p>
</section>
<section id="definition-of-desirability-functions" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-desirability-functions">Definition of desirability functions</h2>
<p>With the functions included in the desirability package we define a desirability function for each response as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(desirability)</span>
<span id="cb9-2"></span>
<span id="cb9-3">D_y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dMax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">170</span>)</span>
<span id="cb9-4">D_y2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dMax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1300</span>)</span>
<span id="cb9-5">D_y3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dTarget</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>)</span>
<span id="cb9-6">D_y4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dTarget</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>)</span></code></pre></div>
</div>
<p>Each target value was set for convenience and was sought to meet the above specifications as outlined in Derringer &amp; Suich (1980).</p>
<p>Global desirability is in turn defined by taking into account the above functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">D_overall <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dOverall</span>(D_y1, D_y2, D_y3, D_y4)</span></code></pre></div>
</div>
</section>
<section id="carrying-out-simultaneous-optimization" class="level2">
<h2 class="anchored" data-anchor-id="carrying-out-simultaneous-optimization">Carrying out simultaneous optimization</h2>
<p>With the previously defined functions we proceed to perform the simultaneous optimization:</p>
<div class="cell" data-hash="index_cache/html/simultaneous optimization_a670352e2c96906e3dc168df01003c47">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">overall_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">maximize_overall</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dObject =</span> D_overall)</span></code></pre></div>
</div>
<p>Depending on your data and the specifications of your computer, this process may be a bit slow.</p>
<p>The processing that allows you to obtain the maximum overall desirability can be deployed directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">overall_opt</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
         x1          x2          x3 
-0.05345891  0.14718872 -0.86635592 

$value
[1] 0.5833527

$counts
function gradient 
     502       NA 

$convergence
[1] 1

$message
NULL</code></pre>
</div>
</div>
<p><code>$value</code> refers to the overall desirability value obtained. This result is practically the same as that published in the Derringer &amp; Suich paper.</p>
</section>
</section>
<section id="obtaining-predictions-of-each-response-variable-in-the-global-optimum" class="level1">
<h1>Obtaining predictions of each response variable in the global optimum</h1>
<p>We can obtain a prediction for each response at the global optimum point:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimal point as a data frame</span></span>
<span id="cb14-2">data_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> overall_opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb14-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2 =</span> overall_opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb14-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x3 =</span> overall_opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb14-6">  )</span>
<span id="cb14-7"></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict each response at overall optimization point</span></span>
<span id="cb14-9">y1_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y1_m, data_opt)</span>
<span id="cb14-10">y2_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y2_m, data_opt)</span>
<span id="cb14-11">y3_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y3_m, data_opt)</span>
<span id="cb14-12">y4_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict.lm</span>(y4_m, data_opt)</span>
<span id="cb14-13"></span>
<span id="cb14-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Response predictions in a data frame</span></span>
<span id="cb14-15">res_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(y1_opt, y2_opt, y3_opt, y4_opt)</span>
<span id="cb14-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(res_opt) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Optimal responses"</span></span>
<span id="cb14-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(res_opt, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  y1_opt y2_opt y3_opt y4_opt
Optimal responses 129.43   1300 465.97  68.02</code></pre>
</div>
</div>
<p>Mission accomplished. All of these values meet the established specifications.</p>
<p>It may also be useful to obtain the individual desirabilities of each response:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimal desirability values </span></span>
<span id="cb16-2">d1_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(D_y1, y1_opt)</span>
<span id="cb16-3">d2_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(D_y2, y2_opt)</span>
<span id="cb16-4">d3_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(D_y3, y3_opt)</span>
<span id="cb16-5">d4_opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(D_y4, y4_opt)</span>
<span id="cb16-6"></span>
<span id="cb16-7">d_opts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(d1_opt, d2_opt, d3_opt, d4_opt)</span>
<span id="cb16-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(d_opts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Optimal desiabilities"</span></span>
<span id="cb16-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(d_opts, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      d1_opt d2_opt d3_opt d4_opt
Optimal desiabilities  0.189      1   0.66  0.931</code></pre>
</div>
</div>
<p>Finally, all predictions must be tested experimentally. For this purpose, it should be considered whether it is possible to adjust the level of each factor to the optimum obtained by simultaneous optimization. If, due to technical limitations, it is not possible to perform the optimal treatment, an alternative could be to evaluate an experimental point that can be fixed in practice and is close to the global optimum obtained. In these cases it would be useful to know how global desirability behaves within our experimental region.</p>
</section>
<section id="desirability-function-display" class="level1">
<h1>Desirability function display</h1>
<p>To perform the desirability function visualizations I also defined a couple of functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate a matrix with desirability predictions within the experimental region</span></span>
<span id="cb18-2">d_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model_1, model_2, model_3, model_4, </span>
<span id="cb18-3">                     dObject,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c3 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>){</span>
<span id="cb18-4">  </span>
<span id="cb18-5">  x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(l_x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], l_x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> by)</span>
<span id="cb18-6">  lx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x)</span>
<span id="cb18-7">  </span>
<span id="cb18-8">  data_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x2 =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x3 =</span> c3)</span>
<span id="cb18-9">  </span>
<span id="cb18-10">  y_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(y1_m, data_x)</span>
<span id="cb18-11">  y_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(y2_m, data_x)</span>
<span id="cb18-12">  y_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(y3_m, data_x)</span>
<span id="cb18-13">  y_4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(y4_m, data_x)</span>
<span id="cb18-14">  </span>
<span id="cb18-15">  d_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(D_overall, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y1 =</span> y_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y2 =</span> y_2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y3 =</span> y_3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y4 =</span> y_4))</span>
<span id="cb18-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(d_m) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(lx, lx)</span>
<span id="cb18-17">  </span>
<span id="cb18-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d_m =</span> d_m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x)</span>
<span id="cb18-19">}</span>
<span id="cb18-20"></span>
<span id="cb18-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deploys a contour plot for desirability within the experimental region</span></span>
<span id="cb18-22">contour_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x2"</span>){</span>
<span id="cb18-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filled.contour</span>(</span>
<span id="cb18-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>d_m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, </span>
<span id="cb18-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color.palette =</span> colorRamps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>matlab.like,</span>
<span id="cb18-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> main, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> xlab, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> ylab, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.lab =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, </span>
<span id="cb18-27">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.main =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>),</span>
<span id="cb18-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.axes =</span> {</span>
<span id="cb18-29">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">axis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.axis =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb18-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">axis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.axis =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb18-31">    }</span>
<span id="cb18-32">  )</span>
<span id="cb18-33">}</span></code></pre></div>
</div>
<p>Since we are dealing with three factors, we set the value of <img src="https://latex.codecogs.com/png.latex?x3"> as a constant in the values -1, 0 and 1 for the contour plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Desirability at x3 = -1</span></span>
<span id="cb19-2">dpx3_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb19-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c3 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>))</span>
<span id="cb19-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contour_d</span>(dpx3_1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x3 = -1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/index_files/figure-html/d contour x3 at -1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Desirability at x3 = 0</span></span>
<span id="cb20-2">dpx3_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb20-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c3 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>))</span>
<span id="cb20-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contour_d</span>(dpx3_2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x3 = 0"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/index_files/figure-html/d contour x3 at 0-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Desirability at x3 = 1</span></span>
<span id="cb21-2">dpx3_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb21-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c3 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>))</span>
<span id="cb21-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contour_d</span>(dpx3_3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x3 = 1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/simultaneus_optimization/index_files/figure-html/d contour x3 at 1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that these functions can also be adapted for any number of response variables and for any number of factors.</p>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li>When conducting an experiment it is usual to measure several response variables. It is also usual to seek to maximize or minimize certain responses while keeping others within specific limits.</li>
<li>The desirability function method seeks an optimal solution considering all response variables. It converts the multivariate problem into a univariate problem by defining a global desirability function.</li>
<li>For this, the responses are transformed into desirability values ranging from 0 to 1 according to the researcher’s objectives. Subsequently, the global desirability is calculated as a weighted average of the individual desirabilities, and the global optimum is sought by numerical methods.</li>
<li>A practical example is provided in R related to the formulation of tire belts using the <code>rsm</code> and <code>desirability</code> packages.</li>
<li>It is possible to visualize the desirability function by means of contour plots.</li>
</ul>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/simultaneus_optimization/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>tutorial</category>
  <category>simultaneus optimization</category>
  <category>response surface design</category>
  <category>desirability package</category>
  <guid>https://juanpacarreon.com/posts/simultaneus_optimization/index.html</guid>
  <pubDate>Tue, 24 Oct 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Prickly pear, a sweet source of nutrients</title>
  <link>https://juanpacarreon.com/posts/prickly-pear-fruits/index.html</link>
  <description><![CDATA[ 




<p>The global prickly pear market has been growing gradually at present. The top exporter in 2022 was Canada, with an export value of 2.89 million USD , while the United States was the top importer in 2022, with an import value of 4.47 million USD , an increase of 6% over 2021. On the other hand, consumer demand for this fruit has also been growing slowly and continues to thrive thanks to its nutritional value and versatility in cooking and traditional medicine.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/prickly-pear-fruits/img/prickly_pear.jpg" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<p>Mexico is considered the largest international producer of prickly pear, followed by South American countries such as Chile, Brazil and Argentina where large quantities are also produced. In Europe, Italy is the largest producer, while Morocco is the leading producer in Africa.</p>
<p>The prickly pear is a common fruit in Mexican markets, especially between July and September, which is the peak production period. In 2019 alone, up to 428,300 tons of this sweet delicacy were produced. And although its production is below other fruits such as oranges, bananas and apples, prickly pear fruits can be considered an important source of various nutrients.</p>
<p>Prickly pear pulp is a good source of carbohydrates, fiber, vitamin C, vitamin A, calcium, potassium and not so well known components such as phenolic compounds, which are known to have several beneficial effects as part of a balanced diet. Its consumption can also be considered as a natural alternative to reduce cholesterol and triglyceride levels, relieve the discomfort caused by ulcers and help stabilize and regulate blood sugar levels.</p>
<p>Although it is more common to find green prickly pears, there are also yellow, orange, red and purple ones. In these different colored varieties there is a group of compounds called betalains, pigments responsible for conferring the color. As an additional benefit, it is also known that the consumption of betalains can reduce cholesterol and triglyceride levels in the blood.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/prickly-pear-fruits/img/tunas_colores.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<p>Prickly pears can be used for the production of juice, jam, vinegar and liquors. From the varieties of different colors are obtained dyes that can be used as an alternative to synthetic dyes in food. The peel of this fruit is usually discarded, but it can also be considered an important source of pigments. Moreover, even edible oil with a high content of beneficial compounds, such as unsaturated fatty acids, vitamin E and vitamin K, can be obtained from the seeds.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/prickly-pear-fruits/img/licor_tuna.webp" class="img-fluid figure-img" width="500"></p>
<figcaption class="figure-caption">Prickly pear liqueur</figcaption>
</figure>
</div>
<p>As mentioned above, Mexico is the world’s leading producer of prickly pear. The main advantage of prickly pear cactus is its low water requirement, which in drought areas makes it a more viable crop than beans and corn. In areas where it is grown extensively, prickly pear cactus is the main source of income for many Mexican families. It is also important to mention that Mexico is the center of origin of the prickly pear, with at least 100 species from which edible fruits can be obtained.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/prickly-pear-fruits/img/tuna_mexico.jpg" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<p>Good for you! Now that you know all this, aren’t you craving for some prickly pears? See you at the market!</p>
<p>If you want to know a little more about the prickly pear, do not hesitate to consult the pages and documents in the following links:</p>
<ul>
<li><a href="https://www.gob.mx/agricultura/es/articulos/frutas-una-delicia-del-campo-mexicano#:~:text=En%202020%2C%20la%20producci%C3%B3n%20nacional,%2C%20pl%C3%A1tano%2C%20aguacate%20y%20mango" target="_blank">Frutas, una delicia del campo mexicano</a>.</li>
<li><a href="https://www.gob.mx/agricultura/articulos/razones-para-comer-tunas-mas-seguido" target="_blank">Razones para comer tunas más seguido</a>.</li>
<li><a href="https://www.redalyc.org/pdf/141/14114743013.pdf" target="_blank">Innovación de productos de alto valor agregado a partir de la tuna mexicana</a>.</li>
<li><a href="https://agroavances.com/img/publicacion_documentos/I7628ES.pdf" target="_blank">Ecología del cultivo, manejo y usos del nopal</a>.</li>
<li><a href="https://cobertura360.mx/2021/08/03/negocios/mexico-exporta-tuna-y-xoconostle-a-eu-canada-japon-emiratos-arabes-unidos-francia-y-reino-unido/" target="_blank">México exporta tuna y xoconostle a EU, Canadá, Japón, Emiratos Árabes Unidos, Francia y Reino Unido</a>.</li>
<li><a href="https://www.tridge.com/intelligences/prickly-pear" target="_blank">2023 Prickly Pear global market overview today - Tridge</a>.</li>
<li><a href="https://southafrica.co.za/global-production-of-cactus-pear.html" target="_blank"> Global Production of Cactus Pear - South Africa Online</a>.</li>
<li><a href="https://www.freshplaza.com/north-america/article/2188177/south-africa-prickly-pear-grower-has-big-plans-for-the-fruit/" target="_blank">South Africa: Prickly pear grower has big plans for the fruit - FreshPlaza</a>.</li>
<li><a href="https://www.producebluebook.com/know-your-produce-commodity/prickly-pear/" target="_blank">Prickly Pear Market Summary - Produce Blue Book</a>.</li>
<li><a href="https://www.agmrc.org/commodities-products/fruits/pears" target="_blank">Pears | Agricultural Marketing Resource Center</a>.</li>
</ul>
<p>The text in this publication is free to use under license <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/prickly-pear-fruits/https:/i.creativecommons.org/l/by/4.0/88x31.png" class="img-fluid figure-img"></a></p>
</figure>
</div>



 ]]></description>
  <category>science communication</category>
  <category>prickly pear</category>
  <guid>https://juanpacarreon.com/posts/prickly-pear-fruits/index.html</guid>
  <pubDate>Thu, 19 Oct 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>R Tutorial: Analysis of results of a nested experimental design</title>
  <link>https://juanpacarreon.com/posts/nested-designs/index.html</link>
  <description><![CDATA[ 




<section id="what-is-a-nested-design" class="level1">
<h1>What is a nested design?</h1>
<p>A <em>nested design</em> is a type of experimental design in which the levels of one factor are hierarchically nested within the levels of another factor. For example, let’s imagine that we are interested in the effect of a type of drug on the expression of a specific gene. For this we design a nested experiment with mice as experimental units (in the figure two mice per treatment), where we include a control. From each mouse we took three cells and in each one we evaluated the expression of the gene twice (technical repetitions).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/nested-designs/images/nested_design.jpg" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<p>As shown in the figure, our design has a hierarchical appearance.</p>
<p>In this type of design we distinguish between two types of factors: <em>fixed</em> and <em>random</em>. A fixed factor is one that has discrete or finite values, while a random factor can take many values. In our example the drug factor would be considered a fixed factor and the mouse, cell and repeated measurements factors would be considered random factors. Note how the random factors are similar, such as mouse and cell, but not identical to each other and these are successively nested until the fixed factor drug.</p>
<p>Now let’s see how we can analyze the results of this type of experimental design with the help of R code. It is important to mention that I took as a basis the publication in <em>nature methods</em>: <a href="https://www.nature.com/articles/nmeth.3137" target="_blank">Nested designs</a> and replicated the example shown using, of course, R code. In addition, I added an extra drug and performed a multiple comparisons test to establish significant differences between the means of each treatment.</p>
<p>If you are interested about how I simulated the data, please take a look at the code in the data_simulation script found in the repository of this tutorial: (link).</p>
</section>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>For the visualization of the results I used <code>ggplot2</code> package and for the statistical analysis I used the <code>GAD</code>, <code>lme4</code>, <code>multicomp</code> and <code>agricolae</code> packages. To install them you can run the following line of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GAD"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lme4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"multcomp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agricolae"</span>))</span></code></pre></div>
</div>
<p>Once installed, it is important not to forget to load these packages in your R session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(GAD)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lme4)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(multcomp)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(agricolae)</span></code></pre></div>
</div>
</section>
<section id="data-import" class="level1">
<h1>Data import</h1>
<p>The data for this tutorial are in the repository <a href="https://github.com/juanpa-biotech/nested-designs/tree/master" target="_blank">nested-designs</a> and you can import with the <code>read_csv()</code> function from <code>readr</code> package. If you have not installed this package, first run the following line of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readr"</span>)</span></code></pre></div>
</div>
<p>Then we load readr in our session and import the data directly from the repository of this post:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb4-2">mice_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/juanpa-biotech/nested-designs/master/mice_data.csv"</span>)</span></code></pre></div>
</div>
<p>We can use the <code>head()</code> function to display the first rows of our data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(mice_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  tech_rep     C     B     A  expr
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1        1     1     1     1  8.55
2        2     1     1     1  9.79
3        3     1     1     1  9.76
4        1     2     1     1  9.47
5        2     2     1     1 10.1 
6        3     2     1     1  9.37</code></pre>
</div>
</div>
<p>The <em>tech_rep</em> column corresponds to technical replicates, <em>A</em> indicates the drug factor levels, <em>B</em> the mouse factor levels and <em>C</em> the cell factor levels. For this example, five mice were used for the control and for each type of drug and five cells were taken from each.The <em>expr</em> column has the expression level data for each treatment, mouse, cell and technical replicate.</p>
<p>In R Studio, it is also possible to display the data in a separate window with the <code>View()</code> function. Try running <code>View(mice_data)</code> in your console and see what happens.</p>
</section>
<section id="visualization-of-experimental-results" class="level1">
<h1>Visualization of experimental results</h1>
<p>As a first step we add three new columns to the data. If you have not installed the <code>dplyr</code> package, first run <code>install.packages(dplyr)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb7-2">mice_data2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mice_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A       =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(A),</span>
<span id="cb7-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drug kind</span></span>
<span id="cb7-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">73</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mice  </span></span>
<span id="cb7-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group_c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cells </span></span>
<span id="cb7-8">  )</span></code></pre></div>
</div>
<p>The added columns will serve to indicate the position of some statistics (means) for each factor on the x-axis of our graph. I saved the result of this operation in a new object, so we keep the original data intact.</p>
<p><code>ggpplot2</code> allows us to build our visualizations by layers, so to build complex plots we simply make simple layers and “stack” them. First we generate a dot plot of the expression levels with respect to group <em>C</em> (cells) and add a horizontal line indicating the mean within each group of measurements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">expr_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mice_data2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> group_c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expr)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> A), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_summary</span>(</span>
<span id="cb8-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crossbar"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb8-5">  )</span>
<span id="cb8-6">expr_plot </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/nested-designs/index_files/figure-html/first layer plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the previous graph each group of three points represents the technical repetitions made in each cell.</p>
<p>Now let’s add an extra layer with red horizontal lines representing the expression means of each mouse:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">expr_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> expr_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_summary</span>(</span>
<span id="cb9-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> group_b, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expr),</span>
<span id="cb9-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crossbar"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb9-5">  )</span>
<span id="cb9-6">expr_plot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/nested-designs/index_files/figure-html/second layer plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As a third layer we add horizontal lines representing the expression means for each treatment, that is, the expression results of each mouse averaged at each drug type and the control:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">expr_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> expr_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-2">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_summary</span>(</span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> group_a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> expr), </span>
<span id="cb10-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crossbar"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb10-5">  )</span>
<span id="cb10-6">expr_plot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/nested-designs/index_files/figure-html/third layer plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, let’s customize the appearance of the chart a bit by modifying font and font sizes, and editing the text of each axis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">expr_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> expr_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expression"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Control"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Drug 1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Drug 2"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb11-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>)),</span>
<span id="cb11-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>))</span>
<span id="cb11-9">  )</span>
<span id="cb11-10">expr_plot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/nested-designs/index_files/figure-html/plot appearance-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>One way to export our graph in some format is by using the <code>ggsave()</code> function. Try running the following line of code and see what happens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expr_plot.jpeg"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> expr_plot)</span></code></pre></div>
</div>
</section>
<section id="inferential-statistical-analysis" class="level1">
<h1>Inferential statistical analysis</h1>
<section id="anova-table" class="level2">
<h2 class="anchored" data-anchor-id="anova-table">ANOVA Table</h2>
<p>As can be seen in our graph, there seems to be a difference between the effect of drug 2 with the other two levels of this factor (drug 1 and control). We can define if there are significant differences by means of an ANOVA table and subsequently a multiple comparisons test.</p>
<p>Let’s obtain the ANOVA table with the <code>GAD</code> package, first we have to specify the fixed and random factors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">drug <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.fixed</span>(mice_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>A)</span>
<span id="cb13-2">mice <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.random</span>(mice_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>B)</span>
<span id="cb13-3">cell <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.random</span>(mice_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>C)</span></code></pre></div>
</div>
<p>To fit the linear model we must take into account the relationship between our response and the previously specified factors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">data_aov <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aov</span>(</span>
<span id="cb14-2">  expr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mice<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> cell<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>mice<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>drug,</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mice_data</span>
<span id="cb14-4">  )</span></code></pre></div>
</div>
<p>The term <code>mice:drug</code> denotes the variability of mice within each treatment, and the term <code>cell:mice:drug</code> denotes the variability of cells within each mouse and in turn within each treatment.</p>
<p>To display the ANOVA table we use the <code>gad()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gad</span>(data_aov)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: expr
                Df Sum Sq Mean Sq F value    Pr(&gt;F)    
drug             2 743.44  371.72  12.796  0.001058 ** 
drug:mice       12 348.59   29.05   5.163 7.413e-06 ***
drug:mice:cell  60 337.59    5.63  11.153 &lt; 2.2e-16 ***
Residual       150  75.67    0.50                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The <code>gad()</code> function distinguishes between fixed and random effects, as well as the nested structure between these factors, so it makes corrections to calculate the <em>F-ratios</em>. The reason for this is that, depending on whether we are considering fixed or random effects, the expected values for the <em>error mean squares</em> (EM) change as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/nested-designs/images/mean_squares.png" class="img-fluid figure-img" width="350"></p>
</figure>
</div>
<p>In the above equations it is possible to observe the nested structure in the mean squares. Also note how for the case of treatments (<img src="https://latex.codecogs.com/png.latex?MS_A">) the expected values add up to the contribution to the variation of mice and cells. Therefore, it is necessary to divide <img src="https://latex.codecogs.com/png.latex?MS_A"> by <img src="https://latex.codecogs.com/png.latex?MS_B"> to obtain the F-ratio and infer differences between treatments.</p>
<p>Importantly, in the case of technical replicates the variability of this random factor is properly estimated by the mean square of the <code>Residual</code> term in our ANOVA table.</p>
</section>
<section id="estimation-of-the-variability-of-each-factor" class="level2">
<h2 class="anchored" data-anchor-id="estimation-of-the-variability-of-each-factor">Estimation of the variability of each factor</h2>
<p>When dealing with random factors, we are mainly interested in estimating their contribution to the variability of the response, as opposed to fixed factors where we are interested in estimating their effect on the population mean.</p>
<p>With the <code>lme4</code> package we can estimate the contribution to variability of mice, cells and properly the error term (technical replicates). First we need to convert the data type in columns <em>A</em>, <em>B</em> and <em>C</em> into factors and then use the <code>lmer()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">mice_data3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mice_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(A), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(B), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(C))</span>
<span id="cb17-3"></span>
<span id="cb17-4">data_lme <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(expr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>C<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>A), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> mice_data3)</span></code></pre></div>
</div>
<p>Note that fitting the linear model with the <code>lmer()</code> function requires a somewhat different syntax than that used with <code>aov()</code> and <code>gad()</code>. To show the contribution to variability of each factor we use the <code>summary()</code> function with the <code>data_lme</code> object as argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(data_lme)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: expr ~ 1 + A + (1 | B:A) + (1 | C:B:A)
   Data: mice_data3

REML criterion at convergence: 684.4

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.76545 -0.53144 -0.02996  0.59495  2.20017 

Random effects:
 Groups   Name        Variance Std.Dev.
 C:B:A    (Intercept) 1.7073   1.3066  
 B:A      (Intercept) 1.5615   1.2496  
 Residual             0.5045   0.7103  
Number of obs: 225, groups:  C:B:A, 75; B:A, 15

Fixed effects:
            Estimate Std. Error t value
(Intercept)  10.0519     0.6224  16.151
A2            1.4654     0.8801   1.665
A3           -2.9085     0.8801  -3.305

Correlation of Fixed Effects:
   (Intr) A2    
A2 -0.707       
A3 -0.707  0.500</code></pre>
</div>
</div>
<p>Under <code>Random effects</code> the term <code>Residual</code> refers to technical replicates, the term <code>B:A</code> to mice and the term <code>C:B:A</code> to cells.</p>
</section>
<section id="multiple-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="multiple-comparisons">Multiple comparisons</h2>
<p>The <code>glth()</code> function of the <code>multcomp</code> package can be used to perform the multiple comparison test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">mult_drug <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glht</span>(data_lme, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linfct =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mcp</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tukey"</span>))</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(mult_drug)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Tests for General Linear Hypotheses

Multiple Comparisons of Means: Tukey Contrasts


Fit: lmer(formula = expr ~ 1 + A + (1 | B:A) + (1 | C:B:A), data = mice_data3)

Linear Hypotheses:
           Estimate Std. Error z value Pr(&gt;|z|)    
2 - 1 == 0   1.4654     0.8801   1.665   0.2188    
3 - 1 == 0  -2.9085     0.8801  -3.305   0.0027 ** 
3 - 2 == 0  -4.3739     0.8801  -4.970   &lt;1e-04 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
(Adjusted p values reported -- single-step method)</code></pre>
</div>
</div>
<p>Alternatively or additionally it is also possible to use the <code>HSD.test()</code> function of the <code>agricolae</code> package. For this I specified the mean squared error for mice (29.05) as well as the degrees of freedom for this factor (12):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">tukey_hsd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(mice_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HSD.test</span>(expr, A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">DFerror =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MSerror =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.05</span>))</span>
<span id="cb22-2">tukey_hsd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>groups</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       expr groups
2 11.517297      a
1 10.051919      a
3  7.143408      b</code></pre>
</div>
</div>
<p>According to the results of the above analyses, we can conclude that drug 2 significantly reduced the gene expression levels compared to drug 1 and the control.</p>
</section>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li>A nested design is a type of experimental design in which the levels of one factor are hierarchically nested within the levels of another factor.</li>
<li>In this type of design, a distinction is made between fixed factors (which have discrete or finite values) and random factors (which can take many values). In the example, the drug factor was considered as fixed, while the mouse, cell and repeated measurements factors were considered random.</li>
<li>It is possible to use the <code>ggplot2</code> package to visualize the results of this type of design.</li>
<li>The <code>GAD</code> package was used to perform the analysis of variance of the results of this design.</li>
<li>The <code>lme4</code> package was used to estimate the contribution to variability of the random factors mice, cells and technical replicates.</li>
<li>Two methods for performing multiple comparisons tests were described, using the <code>multicomp</code> and <code>agricolae</code> packages.</li>
</ul>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/nested-designs/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>tutorial</category>
  <category>statistical inference</category>
  <category>nested design</category>
  <guid>https://juanpacarreon.com/posts/nested-designs/index.html</guid>
  <pubDate>Wed, 11 Oct 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>What is science? - The way we understand and model reality</title>
  <link>https://juanpacarreon.com/posts/what-is-science/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/what-is-science/images/cover.webp" class="img-fluid figure-img" width="1000"></p>
</figure>
</div>
<p>When you want to awaken people’s interest in science, it is important to explain in a general way what it consists of. I do not think I have enough experience to give a detailed explanation of what science is, so I will limit myself to describing what it represents for me and some related concepts.</p>
<section id="what-is-science" class="level1">
<h1>What is science?</h1>
<p>Science can be defined as a human activity in charge of gathering knowledge and describing the different phenomena that make up reality in all its extension and complexity.</p>
<p>Knowing and describing different natural phenomena, including social phenomena, gives us the possibility to develop and improve solutions that satisfy diverse human needs. In this way we can use scientific knowledge to influence reality itself: we cure diseases, improve processes that did not work well before, send satellites to outer space and many other things. At the beginning, when scientific knowledge is produced, it may not have any use, but over time some use may be found, which may depend on advances in other areas of science. Also, of course, all of the above also depends on the branch of science to which we are referring.</p>
<p>Science, above all, is a social activity and, like all human beings, people who do science can and are susceptible to making mistakes. It is worth noting that unlike other human activities, such as religion or politics, science has the necessary mechanisms to detect and correct errors, biases, omissions and other mistakes. Science is undoubtedly an activity that requires the people involved to be self-critical and always willing to improve based on their mistakes.</p>
<p>Although science is not a panacea, a cure for all the ills and problems that afflict humanity, it offers us an objective way to bring prosperity to every human being.</p>
</section>
<section id="the-scientific-method" class="level1">
<h1>The scientific method</h1>
<p>How is science done? Each branch of science has its own methods for generating knowledge. To do science we can follow some general guidelines, but not recipes that must be followed point by point. Below I list several steps that we can follow to generate scientific knowledge, but, in line with what I have just mentioned, we must bear in mind that there may be intermediate steps or even some points can be eliminated or modified depending on the area of knowledge we want to address.</p>
<ol type="1">
<li>Recognize a question. This may be related to some unexplained phenomenon or a problem to which we wish to provide a solution.</li>
<li>Make an adequate conjecture, a hypothesis, of the possible answers to our question. This is usually done through literature research or with the help of other means.</li>
<li>Predict the consequences of the hypothesis. Once we have researched the possible answers, we make a prediction of what they would imply if they were actually true.</li>
<li>We conduct several experiments to test our predictions. From these experiments we obtain data or records. This step is important because it helps us test the hypothersis against the reality.</li>
<li>If our data or records do not agree with our previous predictions, we go back on the fly and look for or generate another hypothesis that might provide the answer to our question.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/what-is-science/images/scientific_method.jfif" class="img-fluid figure-img" width="1000"></p>
<figcaption class="figure-caption">Flow chart of the scientific method</figcaption>
</figure>
</div>
<p>And what conditions must be met for something to be considered science? There are two key aspects:</p>
<ol type="1">
<li>The observations and/or experiments produced when investigating a particular phenomenon must be reproducible. That is, each time we repeat the experiment and our measurements (or records) under the same conditions, the results should be very similar to each other, even if the research is attempted to be reproduced in different places or countries.</li>
<li>Every scientific proposition must be falsifiable, which means that we must be able to formulate experiments whose results would deny the explanations given by such propositions. If it is not possible to formulate, at least with imagination, experiments aimed at demonstrating that what is said by a science is false, then it is quite possible that we are talking not of a science, but of a pseudoscience.</li>
</ol>
</section>
<section id="scientific-measurements" class="level1">
<h1>Scientific measurements</h1>
<p>Measurement plays a central role in science. A measurement, in very general terms, is the assignment of a number to a certain phenomenon in nature. Measurements must be objective and do not depend on the judgment of the person making them. For the mass of an object, for example, we can use a balance, which will show us a number with some associated unit (grams, kilograms, etc.). Undoubtedly, an important part of the development of science is to find good and rigorous ways of making measurements.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/what-is-science/images/measuring_tools.jfif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Some basic measuring instruments</figcaption>
</figure>
</div>
<p>It is important to mention that, depending on the phenomenon, there may not be rigorous ways to measure it. How do we measure some of the phenomena described by the social sciences?</p>
</section>
<section id="hypothesis-law-and-theory" class="level1">
<h1>Hypothesis, law and theory</h1>
<p>As we saw earlier, a hypothesis is an assumption that can be substantiated in research through various means. When a hypothesis is sufficiently tested and no contradiction is found, it is considered a law or principle. A set of concepts, abstractions and laws related to a natural phenomenon becomes a theory. Theories can be considered as the highest level of scientific knowledge, since from these theories research problems can be posed and thus generate more knowledge.</p>
<p>It should be noted that there is no hierarchical relationship between law and theory. A theory is not below a law, nor vice versa. In the case of laws, they usually establish the relationship between different concepts and are simpler than theories. Also, depending on the branch of science, laws may not be as rigorous; a law is not the same in biology as in physics, for example. As for theories, they explain a set of phenomena (they are broader than laws) and are susceptible to change and improve over time based on the evidence that is generated from them or with the help of other branches of science.</p>
</section>
<section id="myths-about-scientific-research" class="level1">
<h1>Myths about scientific research</h1>
<p>There are some beliefs that somehow contribute to people’s lack of interest in science, mainly two:</p>
<ol type="1">
<li>Scientific research is very complicated and difficult. False, any human being can do research if they follow the right process for the problem they want to address. If we think about it carefully we are always doing research in our daily life.</li>
<li>Research is not linked to the everyday world. Also false, many of the conveniences and services we enjoy today have been derived from scientific research: smartphones, internal combustion engines, medicines, nylon, among many other products.</li>
</ol>
<p>Personally, I believe that these misconceptions are due to the inability of research centers, universities and governments to communicate science to as many people as possible. Added to this is the superfluous treatment that the sensationalist media give to science and its findings.</p>
</section>
<section id="deduction-and-induction" class="level1">
<h1>Deduction and induction</h1>
<p>Deduction and induction play a fundamental role in scientific work.</p>
<ul>
<li><p>Deduction. Reaching a particular conclusion from general premises. This is what we do when we formulate hypotheses from existing knowledge or when we make predictions based on established theories and laws.</p></li>
<li><p>Induction. Reaching a general conclusion from observation of particular cases. The conclusion is considered probable, but not necessarily certain since there is always the possibility that new observations or evidence will disprove the conclusion. This is what we do when we perform experimentation to test our hypotheses.</p></li>
</ul>
<p>From both definitions we can infer that deduction and induction are processes that feed back on each other: we derive hypotheses from existing knowledge (deduction), we test these hypotheses again and again, improving at each step the initial hypothesis (induction). When sufficiently tested, the hypothesis becomes part of the theory that will allow us to generate new hypotheses, thus repeating the process of deduction and induction.</p>
</section>
<section id="final-reflection" class="level1">
<h1>Final reflection</h1>
<p>The development of science depends and has depended on the contribution of many people throughout history. It is a constantly changing human activity where its different branches feed back to improve our understanding of the world and the universe of which we are a part.</p>
<p>Scientific thinking is within everyone’s reach, it is not exclusive to universities or special beings. To a greater or lesser extent we can all put into practice the scientific method to ask and solve questions about what surrounds us.</p>
</section>
<section id="to-learn-more-about-this-topic" class="level1">
<h1>To learn more about this topic</h1>
<p>Below is a list with a couple of references and web pages that may be of help if you wish to delve a little deeper into the subject of this publication.</p>
<p>Dahlstrom, M.F. (2014) ‘Using narratives and storytelling to communicate science with nonexpert audiences’, <em>Proceedings of the National Academy of Sciences</em>, 111(supplement_4), pp.&nbsp;13614–13620. Available at: <a href="https://doi.org/10.1073/pnas.1320645111" class="uri">https://doi.org/10.1073/pnas.1320645111</a>.</p>
<p>Rose, S.P.R. (2003) ‘How to (or not to) communicate science’, <em>Biochemical Society Transactions</em>, 31(2), pp.&nbsp;307–312. Available at: <a href="https://doi.org/10.1042/bst0310307" class="uri">https://doi.org/10.1042/bst0310307</a>.</p>
<p><em>scientific method</em> (2023) <em>Encyclopædia Britannica</em>. Available at: <a href="https://www.britannica.com/science/scientific-method" class="uri">https://www.britannica.com/science/scientific-method</a> (Accessed: 27 September 2023).</p>
<p><em>What Is Science?</em> (2021) <em>NASA Science. Space Place. Explore Earth and Space!</em> Available at: <a href="https://spaceplace.nasa.gov/science/en/" class="uri">https://spaceplace.nasa.gov/science/en/</a> (Accessed: 27 September 2023).</p>
<p><em>The text in this publication is free to use under license <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/what-is-science/https:/i.creativecommons.org/l/by/4.0/88x31.png" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>science communication</category>
  <category>scientific method</category>
  <category>scientific thinking</category>
  <guid>https://juanpacarreon.com/posts/what-is-science/index.html</guid>
  <pubDate>Thu, 28 Sep 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Statistical Inference with R</title>
  <link>https://juanpacarreon.com/posts/statistical-inference/index.html</link>
  <description><![CDATA[ 




<p><em>Perfection is always impossible; always it’s an approximation</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Formally, <a href="https://www.sciencedirect.com/topics/neuroscience/statistical-inference" target="_blank">statistical inference</a> can be defined as the process by which conclusions are drawn about a population based on values calculated from a sample drawn from that population.</p>
<p>If your work is related to science in any of its branches I am sure you know that statistical inference plays an important role in the exploration, analysis and validation of our experimental results. A statement is often used as evidence that you have succeeded in testing some hypothesis derived from your research: <em>these results show significant differences with a p-value &lt; 0.05</em>.</p>
<p>In this post I will explain some concepts related to statistical inference and how it can be illustrated using R code.</p>
</section>
<section id="populations-samples-parameters-and-statistics" class="level1">
<h1>Populations, Samples, Parameters and Statistics</h1>
<p>According to <a href="https://dictionary.cambridge.org/es/diccionario/ingles/inference" target="_blank">Cambridge Dictionary</a> , an inference is an assumption that is made or an opinion that is formed from available information. In statistics, the purpose of an inference is to draw conclusions about the population from a sample.</p>
<p>The <em>population</em> is the complete set of objects of interest to us. For example, we may be interested in all the trees of a species located in a forest, all the people in a city, or even the elements of a continuous process such as the cookies produced in a factory. It is important to keep in mind that most of the time we do not have access to the entire population because it is too large and it would be impractical to analyze each element or because the population can be considered a continuum as in the cookie factory.</p>
<p>Statistical inference can help us when we do not have all the information of a population. The first step is to take some elements of this population, which we call a <em>sample</em>. For this we must ensure that the sampling process guarantees that each element of the population has an equal chance of being selected.</p>
<p>Once we obtain the sample we may be interested in some property of the population, so we proceed to measure this characteristic in each element of the sample. This property can be the height, the expression of some gene, the amount of sugar, the hardness, etc. Then, a number is calculated that summarizes the characteristic measured across all elements of the sample. These numbers are usually the mean, variance and standard deviation, which together are called <em>statistics</em>.</p>
<p>Finally, with some assumptions, the population <em>parameters</em> can be inferred from the statistics. The parameters are the mean, standard deviation and variance of the entire population.</p>
<p>See the following figure where I illustrate the whole process with cookies:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/statistical_inference.jpg" class="img-fluid figure-img" width="800"></p>
</figure>
</div>
<p>Depending on the measured characteristic or property different inference methods may be required. In this explanation I will only work with numbers on a continuous scale.</p>
</section>
<section id="calculation-of-statistics" class="level1">
<h1>Calculation of Statistics</h1>
<p>It is time to do some calculations with R code. First I will define a simulated population of 1500 values. Suppose we have measured all the heights of a given tree species:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>)</span>
<span id="cb1-2">population_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</div>
<p>To simulate the values I used the <code>rnorm()</code> function, which returns random values from a normal distribution with a given mean and standard deviation. The <code>round()</code> function rounds the values to the given number of significant figures, and finally the <code>set.seed()</code> function ensures that we always get the same results from this and other code chunks, so if you decide to reproduce them on your own computer the results should also be the same.</p>
<p>Next, let’s take a sample of 30 elements from our simulated population:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb2-2">sample_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(population_trees, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb2-3">sample_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 11.89  9.95 12.65 19.30 12.51 21.27 15.75 12.46 18.07 14.08 15.30 20.11
[13] 10.78 17.12 14.09 14.57 16.02 14.89 13.87 18.05 14.37 17.60 14.55 23.41
[25] 11.80 14.35 15.52 19.99 14.00 18.24</code></pre>
</div>
</div>
<p>Note that the <code>sample()</code> function takes the elements of the given data set randomly, so I also used the <code>set.seed()</code> function to ensure the reproducibility of this example.</p>
<section id="sample-mean-or-sample-average" class="level2">
<h2 class="anchored" data-anchor-id="sample-mean-or-sample-average">Sample Mean or Sample Average</h2>
<p>We can calculate the sample mean with the following equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/mean_s.png" class="img-fluid figure-img" width="150"></p>
</figure>
</div>
<p>The above is the sum (<em>summation</em>) of all the measurements in the sample divided by the sample size (<em>n</em>). <em>i</em> is the index of each item or measurement.</p>
<p>With R code in our previous sample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">ms_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(sample_trees) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_trees)</span>
<span id="cb4-2">ms_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.552</code></pre>
</div>
</div>
<p>We can directly use the <code>mean()</code> function with our data to calculate the mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(sample_trees)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.552</code></pre>
</div>
</div>
</section>
<section id="sample-variance-and-dtandard-deviation" class="level2">
<h2 class="anchored" data-anchor-id="sample-variance-and-dtandard-deviation">Sample Variance and Dtandard Deviation</h2>
<p>For the sample variance you use the next equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/variance_s.png" class="img-fluid figure-img" width="265"></p>
</figure>
</div>
<p>This is described as the sum of the differences between each sample measurement and the sample mean. Each difference is squared, so negative and positive differences do not cancel each other out. The sum is then divided by the sample size minus one.</p>
<p>With R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">vs_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((sample_trees <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ms_trees)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_trees) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-2">vs_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.32456</code></pre>
</div>
</div>
<p>If you are wondering why we have divided by n - 1, I can briefly tell you that this way offers the best estimation of the population variance. You can also check out the next page: <a href="https://www.willemsleegers.com/post/2020/08/05/why-divide-by-n-1/" target="_blank">Why divide by N - 1 when calculating the variance of a sample?</a>.</p>
<p>To obtain the standard deviation, it is sufficient to calculate the square root of the variance, thus providing a measure of the dispersion of the sample in the original units of measurement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">ss_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(vs_trees)</span>
<span id="cb10-2">ss_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.213186</code></pre>
</div>
</div>
<p>As in the case of the mean, with R code we can obtain the variance and standard deviation directly with the <code>var()</code> and <code>sd()</code> functions, respectively:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Sample varianza</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(sample_trees)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.32456</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation </span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(sample_trees)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.213186</code></pre>
</div>
</div>
</section>
</section>
<section id="calculation-of-parameters" class="level1">
<h1>Calculation of Parameters</h1>
<p>If you have all the data for a population, we can also directly calculate the mean, variance and standard deviation.</p>
<section id="mean-or-average-of-the-population" class="level2">
<h2 class="anchored" data-anchor-id="mean-or-average-of-the-population">Mean or average of the population</h2>
<p>To calculate population mean we use the next equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/mean_p.png" class="img-fluid figure-img" width="141"></p>
</figure>
</div>
<p>You can see that this equation is quite similar to the sample mean, but here <em>N</em> refers to all elements of the population. Let’s calculate the mean in our simulated data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">mp_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(population_trees) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(population_trees)</span>
<span id="cb16-2">mp_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.89803</code></pre>
</div>
</div>
<p>Instead of the previous operation you can use the <code>mean()</code> function with the same purpose:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(population_trees)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.89803</code></pre>
</div>
</div>
</section>
<section id="variance-and-standard-deviation-of-the-population" class="level2">
<h2 class="anchored" data-anchor-id="variance-and-standard-deviation-of-the-population">Variance and Standard Deviation of the Population</h2>
<p>The equation for population variance:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/variance_p.png" class="img-fluid figure-img" width="282"></p>
</figure>
</div>
<p>Note that here we divide by the total population size <em>N</em>, not by <em>n-1</em> as in the sampling variance. Let us calculate this parameter in our previous data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">sum_square <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((population_trees <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(population_trees))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb20-2">pv_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sum_square <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(population_trees)</span>
<span id="cb20-3">pv_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.39988</code></pre>
</div>
</div>
<p>The base functions of R do not have one that calculates the population variance, but this can be solved by multiplying the value obtained with var()by (n-1)/n:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">varp_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(population_trees)</span>
<span id="cb22-2">varp_trees <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> varp_trees <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(population_trees) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(population_trees)</span>
<span id="cb22-3">varp_trees</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.39988</code></pre>
</div>
</div>
<p>To calculate the standard deviation it would be sufficient to obtain the square root of the previous value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(varp_trees)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.924268</code></pre>
</div>
</div>
<p>Note that the population mean and standard deviation are close to those specified in the code we used to simulate the data <code>rnorm(1500, mean = 15, sd = 4)</code>.</p>
</section>
</section>
<section id="distributions" class="level1">
<h1>Distributions</h1>
<p>A probability distribution is a function (a table, an equation or a graph) that relates all possible values in a population to their frequencies, counts or probabilities of occurrence.</p>
<p>To illustrate the above let’s simulate a population of 1000 cookies, where we are interested in the diameter of each cookie. The frequency distribution of the diameter would look like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Packages</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb26-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb26-4"></span>
<span id="cb26-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For reproducibility</span></span>
<span id="cb26-6"></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Diameter data from a normal distribution</span></span>
<span id="cb26-8">diameter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean = 5 cm</span></span>
<span id="cb26-9">diameter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">D =</span> diameter)</span>
<span id="cb26-10"></span>
<span id="cb26-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogram </span></span>
<span id="cb26-12">freq_hist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diameter <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> D)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Diameter (cm)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() </span>
<span id="cb26-18">freq_hist</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/cookies distribution-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Although in many cases we will not have all the data from a population, the concept of probability distribution is still important in statistical inference. This is because we can assume that our data come from a theoretical distribution and then test whether the sample statistics belong to that distribution.</p>
<section id="sampling-mean-distribution" class="level2">
<h2 class="anchored" data-anchor-id="sampling-mean-distribution">Sampling Mean Distribution</h2>
<p>The concept of distribution can also be applied to statistics such as the mean. To illustrate the above for our population of cookies let’s repeatedly take samples of size 5 and make a histogram with the averages of these samples:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">151</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For reproducibility</span></span>
<span id="cb27-2"></span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1000 samples</span></span>
<span id="cb27-4">n_samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb27-5"></span>
<span id="cb27-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Empty vector where all means will be stored </span></span>
<span id="cb27-7">mean_cookies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> n_samples)</span>
<span id="cb27-8"></span>
<span id="cb27-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Take a random sample of size 5, calculate the mean and save it in previous vector</span></span>
<span id="cb27-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Repeat the process 1000 times</span></span>
<span id="cb27-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_samples) {</span>
<span id="cb27-12">  mean_cookies[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(diameter<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>D, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) </span>
<span id="cb27-13">}</span>
<span id="cb27-14"></span>
<span id="cb27-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a data frame with all means from samples of size 5</span></span>
<span id="cb27-16">mean_cookies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_n5 =</span> mean_cookies)</span>
<span id="cb27-17"></span>
<span id="cb27-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogram</span></span>
<span id="cb27-19">freq_hist_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mean_cookies <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mean_n5)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Diameter (cm)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() </span>
<span id="cb27-25">freq_hist_mean</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/mean cookies distribution-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The previous code can be repeated with other sample sizes and this will be important in a later section (<em>Central Limit Theorem</em>).</p>
</section>
<section id="the-normal-distribution" class="level2">
<h2 class="anchored" data-anchor-id="the-normal-distribution">The normal distribution</h2>
<p>Since it is rare to know the actual distribution of data, we have to resort to theoretical distributions. There are a lot of such distributions and undoubtedly the <em>normal distribution</em> is the most important in statistical inference. This distribution applies to continuous data (length, weight, temperature, etc.) and is defined by the following equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/normal_eq.png" class="img-fluid figure-img" width="285"></p>
</figure>
</div>
<p>A graph of the above equation looks like this (with mean equal to zero and standard deviation equal to one):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/normal plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="students-t-distribution" class="level2">
<h2 class="anchored" data-anchor-id="students-t-distribution">Student’s t distribution</h2>
<p>When sample sizes are small and the true standard deviation of the population is not known, <em>Student’s t-distribution</em> can be used to make a good guess of the distribution of the data. The shape of this distribution depends on the sample size and for large sample sizes the t-distribution tends to be normal:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/t distributions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The black line corresponds to a sample size of 2, the red line to a sample size of 4, the blue one to a size of 10, and the green one to a size of 50.</p>
</section>
</section>
<section id="central-limit-theorem" class="level1">
<h1>Central Limit Theorem</h1>
<p>The central limit theorem states that even if the original data do not follow a normal distribution, the sampling distribution of the mean of the data will tend to follow a normal distribution when the sample size is large enough.</p>
<p>To illustrate this theorem let’s simulate data from a non-normal distribution:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span>
<span id="cb28-2"></span>
<span id="cb28-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate data from a uniform distribution</span></span>
<span id="cb28-4">non_normal_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)) </span>
<span id="cb28-5"></span>
<span id="cb28-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogram</span></span>
<span id="cb28-7">non_normal_hist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(non_normal_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb28-11">non_normal_hist</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/data non-normal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s take 1000 samples of size 2, calculate their means, and made a histogram with all these means:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb29-2"></span>
<span id="cb29-3">mean_n2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb29-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) {</span>
<span id="cb29-5">  mean_n2[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb29-6">}</span>
<span id="cb29-7"></span>
<span id="cb29-8">hist_n2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mean_n2), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean value (n = 2)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb29-13"></span>
<span id="cb29-14">hist_n2</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/n5 means-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can repeat the same process with samples of size 10:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb30-2"></span>
<span id="cb30-3">mean_n10 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb30-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) {</span>
<span id="cb30-5">  mean_n10[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb30-6">}</span>
<span id="cb30-7"></span>
<span id="cb30-8">hist_n10 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mean_n10), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean value (n = 10)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb30-13"></span>
<span id="cb30-14">hist_n10</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/n10 means-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Then with samples of size 30:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb31-2"></span>
<span id="cb31-3">mean_n30 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb31-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) {</span>
<span id="cb31-5">  mean_n30[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))</span>
<span id="cb31-6">}</span>
<span id="cb31-7"></span>
<span id="cb31-8">hist_n30 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> mean_n30), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean value (n = 30)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span>
<span id="cb31-13"></span>
<span id="cb31-14">hist_n30</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/n30 means-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It can be observed that as the sample size increases the distribution of the mean tends to adopt a bell shape. That is, the distribution of the mean tends to normality as we increase the sample size. Note also how all distributions of the mean are centered around the mean of the original data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggpubr) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Arrange multiple ggplots on the same figure</span></span>
<span id="cb32-2"></span>
<span id="cb32-3">hist_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(non_normal_hist, hist_n2, hist_n10, hist_n30)</span>
<span id="cb32-4">hist_means</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/all means dist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What happens to the variance and standard deviation of the sampling distributions of the mean? These parameters decrease in each distribution as we increase the sample size. Let’s calculate the standard deviations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">dist_sds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb33-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Distribution =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Non normal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n = 2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n = 10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n = 30"</span>),</span>
<span id="cb33-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(mean_n2), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(mean_n10), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(mean_n30))</span>
<span id="cb33-4">  )</span>
<span id="cb33-5">dist_sds</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Distribution        SD
1   Non normal 28.954840
2        n = 2 20.406067
3       n = 10  9.225895
4       n = 30  5.056629</code></pre>
</div>
</div>
<p>The reduction of standard deviation values tends to be equal to dividing the standard deviation of the original data by the square root of the sample size (this value is also known as the <em>standard error</em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation for samples of size 2</span></span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20.47416</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation for samples of size 10</span></span>
<span id="cb37-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)  </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.156324</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation for samples of size 30</span></span>
<span id="cb39-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)  </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.286406</code></pre>
</div>
</div>
<p>Thus, the central limit theorem allows us to use statistical methods based on a normal distribution with data from non-normal distributions.</p>
</section>
<section id="statistical-inference" class="level1">
<h1>Statistical Inference</h1>
<p>It is time to put into practice the concepts we have covered so far. We are going to work with a sample of size 10 drawn from the non-normal distribution we simulated in the previous section. The objective is to infer whether the population mean is equal to 30 based on the sample mean we obtain.</p>
<p>First, we take the sample and calculate its mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">92</span>)</span>
<span id="cb41-2"></span>
<span id="cb41-3">sample_n10 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(non_normal_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb41-4">mean_n10   <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(sample_n10)</span>
<span id="cb41-5">mean_n10</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53.70605</code></pre>
</div>
</div>
<p>As a next step we standardize this value in order to compare it with the values of a theoretical distribution. This calculation is performed by subtracting the hypothetical population mean (30) from the sample mean we obtained. The result of the above subtraction is then divided by the standard error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">st_error  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(sample_n10) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_n10))</span>
<span id="cb43-2">stand_n10 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (mean_n10 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> st_error</span>
<span id="cb43-3">stand_n10</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.458524</code></pre>
</div>
</div>
<p>Suppose we do not have all the values of the simulated population, but we do have the values of a Student’s t-distribution with mean 30 and an error or standard deviation equal to that of our sample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">x_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb45-2">data_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_vals =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qt</span>(x_vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>))</span>
<span id="cb45-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_t, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(t_vals)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb45-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb45-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t values"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb45-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb45-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://juanpacarreon.com/posts/statistical-inference/index_files/figure-html/t distribution-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this example the <code>qt()</code> function generates standardized values by default, so no additional operations have to be performed.</p>
<p>Now let us ask the question: What proportion of values in the t distribution are greater than the standardized value of our sample? We can answer with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(data_t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_vals) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> stand_n10) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(data_t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_vals)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03796204</code></pre>
</div>
</div>
<p>Only a small proportion of all values in the theoretical distribution are larger, in absolute terms, than the mean we obtained, so we could infer that the population mean we are interested in is other than 30.</p>
<p>All of the above can be done with the <code>t.test()</code> function and our sample data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(sample_n10, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alternative =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two.sided"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  sample_n10
t = 2.4585, df = 9, p-value = 0.03625
alternative hypothesis: true mean is not equal to 30
95 percent confidence interval:
 31.89345 75.51865
sample estimates:
mean of x 
 53.70605 </code></pre>
</div>
</div>
<p>The ratio we calculated previously is better known as <em>p-value</em>. Note how the value obtained by the <code>t.test()</code> function is quite similar.</p>
<p>It is also important to note that the argument <code>alternative = "two.sided"</code> in the <code>t.test()</code> function refers to a <em>two-tailed hypothesis test</em>. That is, sufficiently large or sufficiently small sample means will lead us to conclude that the population mean is different from 30. For this reason I used the <code>abs()</code> function in the proportion calculation to include the negative and positive values of the t distribution whose absolute values were greater than the standardized sample value.</p>
<p>How small must the proportion of values in the theoretical distribution be to infer that our statistic is not part of that distribution? A general and widely accepted rule of thumb is usually set at a proportion of 0.05. In other words, if our <em>p-value</em> is less than 0.05 we can conclude that the population mean is significantly different from the hypothesized value.</p>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li>Statistical inference allows us to make inferences about the parameters of a population based on statistics calculated from a sample.</li>
<li>For data on a continuous measurement scale, statistics such as mean, variance and standard deviation are usually calculated. With R code it is possible to calculate these statistics with <code>mean()</code>, <code>var()</code> and <code>sd()</code> functions.</li>
<li>A probability distribution relates the possible values of a population to their frequencies, counts or probabilities of occurrence.</li>
<li>The central limit theorem states that the sampling distribution of the mean tends to be normal when the sample size is large enough, even if the original data do not follow a normal distribution.</li>
<li>The <code>t.test()</code> function can be used to make inferences about the population mean based on sample data.</li>
<li>As a rule of thumb, if the obtained <em>p-value</em> is less than 0.05 we can state that the population mean is different from some hypothetical value.</li>
</ul>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://juanpacarreon.com/posts/statistical-inference/https:/img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>statistical inference</category>
  <category>statistics</category>
  <category>population</category>
  <category>sample</category>
  <category>parameters</category>
  <category>mean</category>
  <category>variance</category>
  <category>standard deviation</category>
  <guid>https://juanpacarreon.com/posts/statistical-inference/index.html</guid>
  <pubDate>Wed, 27 Sep 2023 05:00:00 GMT</pubDate>
</item>
</channel>
</rss>

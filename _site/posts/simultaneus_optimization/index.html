<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-24">
<meta name="description" content="A tutorial with R code to perform simultaneous optimization of several response variables">

<title>Juan Pablo Carreón Hidalgo - R tutorial: Simultaneus Optimization of Several Response Variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Juan Pablo Carreón Hidalgo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About the author</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/juanpa-biotech" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/juanpa_biotech" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">R tutorial: Simultaneus Optimization of Several Response Variables</h1>
                  <div>
        <div class="description">
          A tutorial with R code to perform simultaneous optimization of several response variables
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">tutorial</div>
                <div class="quarto-category">simultaneus optimization</div>
                <div class="quarto-category">response surface design</div>
                <div class="quarto-category">desirability package</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 24, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-problem-of-optimizing-several-response-variables" id="toc-the-problem-of-optimizing-several-response-variables" class="nav-link active" data-scroll-target="#the-problem-of-optimizing-several-response-variables">The problem of optimizing several response variables</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#second-order-model-fitting" id="toc-second-order-model-fitting" class="nav-link" data-scroll-target="#second-order-model-fitting">Second-order model fitting</a></li>
  <li><a href="#simultaneous-optimization" id="toc-simultaneous-optimization" class="nav-link" data-scroll-target="#simultaneous-optimization">Simultaneous optimization</a>
  <ul class="collapse">
  <li><a href="#definition-of-functions-for-simultaneous-optimization" id="toc-definition-of-functions-for-simultaneous-optimization" class="nav-link" data-scroll-target="#definition-of-functions-for-simultaneous-optimization">Definition of functions for simultaneous optimization</a></li>
  <li><a href="#definition-of-desirability-functions" id="toc-definition-of-desirability-functions" class="nav-link" data-scroll-target="#definition-of-desirability-functions">Definition of desirability functions</a></li>
  <li><a href="#carrying-out-simultaneous-optimization" id="toc-carrying-out-simultaneous-optimization" class="nav-link" data-scroll-target="#carrying-out-simultaneous-optimization">Carrying out simultaneous optimization</a></li>
  </ul></li>
  <li><a href="#obtaining-predictions-of-each-response-variable-in-the-global-optimum" id="toc-obtaining-predictions-of-each-response-variable-in-the-global-optimum" class="nav-link" data-scroll-target="#obtaining-predictions-of-each-response-variable-in-the-global-optimum">Obtaining predictions of each response variable in the global optimum</a></li>
  <li><a href="#desirability-function-display" id="toc-desirability-function-display" class="nav-link" data-scroll-target="#desirability-function-display">Desirability function display</a></li>
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points">Key points</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>The data and code for this publication can be found in the following repository: <a href="https://github.com/juanpa-biotech/simultaneous-optimization" target="_blank">simultaneous-optimization</a>.</p>
<section id="the-problem-of-optimizing-several-response-variables" class="level1">
<h1>The problem of optimizing several response variables</h1>
<p>When we perform an experiment it is common to quantify more than one response variable in each of our experimental units. Depending on our objectives or needs, we might be interested in maximizing and/or minimizing some responses, while some others would only be measured to characterize the process, but we want them to stay within defined limits. How do we approach optimization taking into account each response variable? In other words, we want to find an optimal solution that allows us to find the best, or desirable, values for each response.</p>
<p>One way to solve the above problem is by means of the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6217265/" target="_blank">desirability function method</a>, which allows us to obtain a global optimum taking into account all the response variables.</p>
<p>In general, the desirability function method consists of defining a function that covers the entire experimental region and estimates the global desirability (<span class="math inline">\(GD\)</span>). The <span class="math inline">\(GD\)</span> in turn is defined taking into account all the responses, which allows to reduce a multivariate optimization problem to a single variable one. The objective becomes maximizing <span class="math inline">\(GD\)</span>.</p>
<p>To define GD we first transform each predicted response <span class="math inline">\(yp_i(x)\)</span> into an individual desirability value <span class="math inline">\(d_i(x)\)</span> that falls in the interval <span class="math inline">\([0, 1]\)</span>. The transformation <span class="math inline">\(d_i(x)\)</span> of each response is performed according to the target values set by the investigator and measures the desirability at the experimental point or treatment <span class="math inline">\(X = (x_1, x_2, x_3, ..., x_k)\)</span>, where each <span class="math inline">\(x_i\)</span> corresponds to each of the experimental factors considered in the design.</p>
<p>If the variable <span class="math inline">\(yp_i(x)\)</span> has an upper specification (<span class="math inline">\(US_i\)</span>), a lower specification (<span class="math inline">\(LS_i\)</span>) and its target value is <span class="math inline">\(T_i\)</span>, the transformation <span class="math inline">\(d_i(x)\)</span> is defined as:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/eq_1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The exponents <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span> are used to choose the form of the transformation. Assigning large values to these exponents, greater than or equal to 5, for example, will only yield desirability values close to 1 when <span class="math inline">\(yp_i(x)\)</span> is sufficiently close to the target value. On the other hand, selecting small values of <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span> <span class="math inline">\((≤ 0.10)\)</span> will yield desirability values close to 1 for a wide range of values within the interval <span class="math inline">\([LS_i, US_i]\)</span>. If both exponents are selected equal to 1, a linear increase in desirability will be obtained as the values of <span class="math inline">\(yp_i(x)\)</span> approach the target value.</p>
<p>Once the <span class="math inline">\(m\)</span> desirabilities have been calculated for the <span class="math inline">\(m\)</span> responses at the point within the experimental region <span class="math inline">\(X_i\)</span>, the <span class="math inline">\(GD\)</span> at <span class="math inline">\(X_i\)</span> is defined by a weighted geometric mean:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/eq_2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In this case, the weights <span class="math inline">\(w_i\)</span> are constants that are assigned to balance the relative importance of each response variable compared to the others. The larger the value of <span class="math inline">\(w\)</span>, the greater the requirement that the <span class="math inline">\(GD\)</span> result benefits that response. If we select a value of 1 for each <span class="math inline">\(w\)</span>, the above equation reduces to:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/eq_3.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The global optimum experimental point <span class="math inline">\(X_0\)</span> is the point at which the value of <span class="math inline">\(GD(X_0)\)</span> is maximum. To find this maximum value we apply a numerical method.</p>
<p>With this brief explanation of the method, it is now time to perform a practical example with R code. For this I will use the data published in <a href="https://www.tandfonline.com/doi/abs/10.1080/00224065.1980.11980968" target="_balnk">George Derringer &amp; Ronald Suich (1980)</a>.</p>
</section>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>For this post I used the <code>readr</code>, <code>rsm</code>, <code>desirability</code> and <code>colorRamps</code> packages. If you haven’t installed them you can run the following code to do so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"readr"</span>, <span class="st">"rsm"</span>, <span class="st">"desirability"</span>, <span class="st">"colorRamps"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level1">
<h1>Import data</h1>
<p>The experimental data are in a CSV file and have the usual structure of a design matrix. To import the data from the repository of this post we can use the <code>read_csv()</code> function of the <code>readr</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_tires <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/juanpa-biotech/simultaneous-optimization/master/data_tires.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_tires)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
     x1    x2    x3    Y1    Y2    Y3    Y4
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    -1    -1     1   102   900   470  67.5
2     1    -1    -1   120   860   410  65  
3    -1     1    -1   117   800   570  77.5
4     1     1     1   198  2294   240  74.5
5    -1    -1    -1   103   490   640  62.5
6     1    -1     1   132  1289   270  67  </code></pre>
</div>
</div>
<p>The data correspond to an experiment whose objective is to improve the formulation of belts for the manufacture of tires, so that certain quality parameters are met. The <span class="math inline">\(x_i\)</span> correspond to the factors and the <span class="math inline">\(Y_i\)</span> to the responses.</p>
<p>The information in the columns is as follows:</p>
<ul>
<li><span class="math inline">\(x1\)</span>: level of hydrated silica.</li>
<li><span class="math inline">\(x2\)</span>: level of silane coupling agent</li>
<li><span class="math inline">\(x3\)</span>: sulfur level</li>
<li><span class="math inline">\(Y1\)</span>: PICO abrasion index</li>
<li><span class="math inline">\(Y2\)</span>: modulus 200</li>
<li><span class="math inline">\(Y3\)</span>: elongation at break</li>
<li><span class="math inline">\(Y4\)</span>: hardness</li>
</ul>
<p>We look for the values of each response variable to meet the following requirements:</p>
<ul>
<li><span class="math inline">\(Y1 &gt; 120\)</span></li>
<li><span class="math inline">\(Y2 &gt; 1000\)</span></li>
<li><span class="math inline">\(400 &lt; Y3 &lt; 600\)</span></li>
<li><span class="math inline">\(60 &lt; Y4 &lt; 75\)</span></li>
</ul>
<p>Thus we could ask the question: Which treatment (combination of the <span class="math inline">\(x_i\)</span>) within our experimental region would allow us to achieve the above specifications?</p>
</section>
<section id="second-order-model-fitting" class="level1">
<h1>Second-order model fitting</h1>
<p>It is important to note that the experimental design that corresponds to our data is a response surface design, so we fit second-order models for each response using the <code>rsm</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsm)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>y1_m  <span class="ot">&lt;-</span> <span class="fu">rsm</span>(Y1 <span class="sc">~</span> <span class="fu">SO</span>(x1, x2, x3), <span class="at">data =</span> data_tires)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>y2_m  <span class="ot">&lt;-</span> <span class="fu">rsm</span>(Y2 <span class="sc">~</span> <span class="fu">SO</span>(x1, x2, x3), <span class="at">data =</span> data_tires)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>y3_m  <span class="ot">&lt;-</span> <span class="fu">rsm</span>(Y3 <span class="sc">~</span> <span class="fu">SO</span>(x1, x2, x3), <span class="at">data =</span> data_tires)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>y4_m  <span class="ot">&lt;-</span> <span class="fu">rsm</span>(Y4 <span class="sc">~</span> <span class="fu">SO</span>(x1, x2, x3), <span class="at">data =</span> data_tires)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The models for each response follow the general equation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/eq_4.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>To get an idea of the variability explained by each model I defined a small function that returns the coefficient of determination and the fitted coefficient of determination for a given model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a R^2 and adjusted R^2 from a linear model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>get_r2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  sum_model <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">c</span>(<span class="at">R2 =</span> sum_model<span class="sc">$</span>r.squared, <span class="at">adj.R2 =</span> sum_model<span class="sc">$</span>adj.r.squared), <span class="dv">3</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Table with R-squared for each model</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>y1_r2 <span class="ot">&lt;-</span> <span class="fu">get_r2</span>(y1_m)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>y2_r2 <span class="ot">&lt;-</span> <span class="fu">get_r2</span>(y2_m)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>y3_r2 <span class="ot">&lt;-</span> <span class="fu">get_r2</span>(y3_m) </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>y4_r2 <span class="ot">&lt;-</span> <span class="fu">get_r2</span>(y4_m)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>r2t <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">data.frame</span>(<span class="at">y1_m =</span> y1_r2, <span class="at">y2_m =</span> y2_r2, <span class="at">y3_m =</span> y3_r2, <span class="at">y4_m =</span> y4_r2))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>r2t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        R2 adj.R2
y1_m 0.972  0.947
y2_m 0.742  0.510
y3_m 0.981  0.965
y4_m 0.958  0.921</code></pre>
</div>
</div>
<p>As can be seen in the table, the coefficients of determination of the <span class="math inline">\(Y2\)</span> model are lower than the rest. This should be taken into account, as there could be another model that fits the <span class="math inline">\(Y2\)</span> data better. However, for learning purposes I used all quadratic models as was done in the Derringer &amp; Suich (1980) paper.</p>
</section>
<section id="simultaneous-optimization" class="level1">
<h1>Simultaneous optimization</h1>
<section id="definition-of-functions-for-simultaneous-optimization" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-functions-for-simultaneous-optimization">Definition of functions for simultaneous optimization</h2>
<p>For simultaneous optimization I defined a couple of functions. First a prediction function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction function</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rsm_opt <span class="ot">&lt;-</span> <span class="cf">function</span>(x, dObject, <span class="at">space =</span> <span class="st">"square"</span>){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> x[<span class="dv">1</span>], <span class="at">x2 =</span> x[<span class="dv">2</span>], <span class="at">x3 =</span> x[<span class="dv">3</span>])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y1_m, df)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y2_m, df)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  y3 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y3_m, df)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  y4 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y4_m, df)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">predict</span>(dObject, <span class="fu">data.frame</span>(<span class="at">y1 =</span> y1, <span class="at">y2 =</span> y2, <span class="at">y3 =</span> y3, <span class="at">y4 =</span> y4))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(space <span class="sc">==</span> <span class="st">"circular"</span> <span class="sc">&amp;</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">&gt;</span> <span class="fl">1.63</span>) out <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(space <span class="sc">==</span> <span class="st">"square"</span> <span class="sc">&amp;</span> <span class="fu">any</span>(<span class="fu">abs</span>(x) <span class="sc">&gt;</span> <span class="fl">1.63</span>)) out <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function specifies two possible shapes for the experimental region: <em>square</em> and <em>circular</em>. This must be taken into account and may vary according to our experimental design.</p>
<p>Subsequently, I defined a function that will be in charge of finding the best global desirability value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimization function</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>maximize_overall <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">int_1 =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.63</span>, <span class="fl">1.63</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">int_2 =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.63</span>, <span class="fl">1.63</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">int_3 =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.63</span>, <span class="fl">1.63</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">dObject =</span> <span class="cn">NULL</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">space =</span> <span class="st">"square"</span>){</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  searchGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x1 =</span> <span class="fu">seq</span>(int_1[<span class="dv">1</span>], int_1[<span class="dv">2</span>], <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x2 =</span> <span class="fu">seq</span>(int_2[<span class="dv">1</span>], int_2[<span class="dv">2</span>], <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x3 =</span> <span class="fu">seq</span>(int_3[<span class="dv">1</span>], int_3[<span class="dv">2</span>], <span class="at">length.out =</span> <span class="dv">5</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(searchGrid)[<span class="dv">1</span>]){</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="fu">as.vector</span>(searchGrid[i,]),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                 rsm_opt,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dObject =</span> dObject,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">space =</span> space, </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>) best <span class="ot">&lt;-</span> tmp</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(tmp<span class="sc">$</span>value <span class="sc">&gt;</span> best<span class="sc">$</span>value) best <span class="ot">&lt;-</span> tmp</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  best</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in the previous functions I took into account the maximum and minimum coded values of each factor, in this case 1.63 and -1.63, respectively. If you wish to use this code with your own data do not forget to modify these values according to your experimental design.</p>
</section>
<section id="definition-of-desirability-functions" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-desirability-functions">Definition of desirability functions</h2>
<p>With the functions included in the desirability package we define a desirability function for each response as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(desirability)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>D_y1 <span class="ot">&lt;-</span> <span class="fu">dMax</span>(<span class="dv">120</span>, <span class="dv">170</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>D_y2 <span class="ot">&lt;-</span> <span class="fu">dMax</span>(<span class="dv">1000</span>, <span class="dv">1300</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>D_y3 <span class="ot">&lt;-</span> <span class="fu">dTarget</span>(<span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">600</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>D_y4 <span class="ot">&lt;-</span> <span class="fu">dTarget</span>(<span class="dv">60</span>, <span class="fl">67.5</span>, <span class="dv">75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each target value was set for convenience and was sought to meet the above specifications as outlined in Derringer &amp; Suich (1980).</p>
<p>Global desirability is in turn defined by taking into account the above functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>D_overall <span class="ot">&lt;-</span> <span class="fu">dOverall</span>(D_y1, D_y2, D_y3, D_y4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="carrying-out-simultaneous-optimization" class="level2">
<h2 class="anchored" data-anchor-id="carrying-out-simultaneous-optimization">Carrying out simultaneous optimization</h2>
<p>With the previously defined functions we proceed to perform the simultaneous optimization:</p>
<div class="cell" data-hash="index_cache/html/simultaneous optimization_a670352e2c96906e3dc168df01003c47">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>overall_opt <span class="ot">&lt;-</span> <span class="fu">maximize_overall</span>(<span class="at">dObject =</span> D_overall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Depending on your data and the specifications of your computer, this process may be a bit slow.</p>
<p>The processing that allows you to obtain the maximum overall desirability can be deployed directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>overall_opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
         x1          x2          x3 
-0.05345891  0.14718872 -0.86635592 

$value
[1] 0.5833527

$counts
function gradient 
     502       NA 

$convergence
[1] 1

$message
NULL</code></pre>
</div>
</div>
<p><code>$value</code> refers to the overall desirability value obtained. This result is practically the same as that published in the Derringer &amp; Suich paper.</p>
</section>
</section>
<section id="obtaining-predictions-of-each-response-variable-in-the-global-optimum" class="level1">
<h1>Obtaining predictions of each response variable in the global optimum</h1>
<p>We can obtain a prediction for each response at the global optimum point:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal point as a data frame</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data_opt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> overall_opt<span class="sc">$</span>par[<span class="dv">1</span>],</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> overall_opt<span class="sc">$</span>par[<span class="dv">2</span>],</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x3 =</span> overall_opt<span class="sc">$</span>par[<span class="dv">3</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict each response at overall optimization point</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>y1_opt <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y1_m, data_opt)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>y2_opt <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y2_m, data_opt)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>y3_opt <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y3_m, data_opt)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>y4_opt <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(y4_m, data_opt)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Response predictions in a data frame</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>res_opt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y1_opt, y2_opt, y3_opt, y4_opt)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(res_opt) <span class="ot">&lt;-</span> <span class="st">"Optimal responses"</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(res_opt, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  y1_opt y2_opt y3_opt y4_opt
Optimal responses 129.43   1300 465.97  68.02</code></pre>
</div>
</div>
<p>Mission accomplished. All of these values meet the established specifications.</p>
<p>It may also be useful to obtain the individual desirabilities of each response:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal desirability values </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>d1_opt <span class="ot">&lt;-</span> <span class="fu">predict</span>(D_y1, y1_opt)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>d2_opt <span class="ot">&lt;-</span> <span class="fu">predict</span>(D_y2, y2_opt)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>d3_opt <span class="ot">&lt;-</span> <span class="fu">predict</span>(D_y3, y3_opt)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>d4_opt <span class="ot">&lt;-</span> <span class="fu">predict</span>(D_y4, y4_opt)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>d_opts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(d1_opt, d2_opt, d3_opt, d4_opt)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(d_opts) <span class="ot">&lt;-</span> <span class="st">"Optimal desiabilities"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(d_opts, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      d1_opt d2_opt d3_opt d4_opt
Optimal desiabilities  0.189      1   0.66  0.931</code></pre>
</div>
</div>
<p>Finally, all predictions must be tested experimentally. For this purpose, it should be considered whether it is possible to adjust the level of each factor to the optimum obtained by simultaneous optimization. If, due to technical limitations, it is not possible to perform the optimal treatment, an alternative could be to evaluate an experimental point that can be fixed in practice and is close to the global optimum obtained. In these cases it would be useful to know how global desirability behaves within our experimental region.</p>
</section>
<section id="desirability-function-display" class="level1">
<h1>Desirability function display</h1>
<p>To perform the desirability function visualizations I also defined a couple of functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a matrix with desirability predictions within the experimental region</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>d_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(model_1, model_2, model_3, model_4, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                     dObject,  <span class="at">c3 =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">l_x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">by =</span> <span class="fl">0.1</span>){</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(l_x[<span class="dv">1</span>], l_x[<span class="dv">2</span>], <span class="at">by =</span> by)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  lx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  data_x <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x, <span class="at">x2 =</span> x, <span class="at">x3 =</span> c3)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  y_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(y1_m, data_x)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  y_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(y2_m, data_x)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  y_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(y3_m, data_x)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  y_4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(y4_m, data_x)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  d_m <span class="ot">&lt;-</span> <span class="fu">predict</span>(D_overall, <span class="fu">data.frame</span>(<span class="at">Y1 =</span> y_1, <span class="at">Y2 =</span> y_2, <span class="at">Y3 =</span> y_3, <span class="at">Y4 =</span> y_4))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(d_m) <span class="ot">&lt;-</span> <span class="fu">c</span>(lx, lx)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">d_m =</span> d_m, <span class="at">x =</span> x)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploys a contour plot for desirability within the experimental region</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>contour_d <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">main =</span> <span class="st">" "</span>,  <span class="at">xlab =</span> <span class="st">"x1"</span>, <span class="at">ylab =</span> <span class="st">"x2"</span>){</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filled.contour</span>(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> data<span class="sc">$</span>d_m, <span class="at">x =</span> data<span class="sc">$</span>x, <span class="at">y =</span> data<span class="sc">$</span>x, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color.palette =</span> colorRamps<span class="sc">::</span>matlab.like,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">title</span>(<span class="at">main =</span> main, <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> ylab, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cex.main =</span> <span class="fl">1.5</span>),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.axes =</span> {</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we are dealing with three factors, we set the value of <span class="math inline">\(x3\)</span> as a constant in the values -1, 0 and 1 for the contour plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Desirability at x3 = -1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dpx3_1 <span class="ot">&lt;-</span> <span class="fu">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">c3 =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">l_x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.6</span>, <span class="fl">1.6</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour_d</span>(dpx3_1, <span class="at">main =</span> <span class="st">"x3 = -1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/d contour x3 at -1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Desirability at x3 = 0</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dpx3_2 <span class="ot">&lt;-</span> <span class="fu">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">c3 =</span> <span class="dv">0</span>, <span class="at">l_x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.6</span>, <span class="fl">1.6</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour_d</span>(dpx3_2, <span class="at">main =</span> <span class="st">"x3 = 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/d contour x3 at 0-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Desirability at x3 = 1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dpx3_3 <span class="ot">&lt;-</span> <span class="fu">d_matrix</span>(y1_m, y2_m, y3_m, y4_m, D_overall, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">c3 =</span> <span class="dv">1</span>, <span class="at">l_x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.6</span>, <span class="fl">1.6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour_d</span>(dpx3_3, <span class="at">main =</span> <span class="st">"x3 = 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/d contour x3 at 1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that these functions can also be adapted for any number of response variables and for any number of factors.</p>
</section>
<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li>When conducting an experiment it is usual to measure several response variables. It is also usual to seek to maximize or minimize certain responses while keeping others within specific limits.</li>
<li>The desirability function method seeks an optimal solution considering all response variables. It converts the multivariate problem into a univariate problem by defining a global desirability function.</li>
<li>For this, the responses are transformed into desirability values ranging from 0 to 1 according to the researcher’s objectives. Subsequently, the global desirability is calculated as a weighted average of the individual desirabilities, and the global optimum is sought by numerical methods.</li>
<li>A practical example is provided in R related to the formulation of tire belts using the <code>rsm</code> and <code>desirability</code> packages.</li>
<li>It is possible to visualize the desirability function by means of contour plots.</li>
</ul>
<p>The code on this post is licensed under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>